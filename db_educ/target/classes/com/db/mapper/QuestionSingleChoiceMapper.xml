<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.db.service.QuestionSingleChoiceService">
	<resultMap id="SingleMap" type="com.db.entity.QuestionSingleChoice">
		<result column="choice_id" property="choiceId" jdbcType="INTEGER" />
		<result column="choice_desc" property="choiceDesc" jdbcType="VARCHAR" />
		<result column="choice_optionA" property="OptionA" jdbcType="VARCHAR" />
		<result column="choice_optionB" property="OptionB" jdbcType="VARCHAR" />
		<result column="choice_optionC" property="OptionC" jdbcType="VARCHAR" />
		<result column="choice_optionD" property="OptionD" jdbcType="VARCHAR" />
		<result column="choice_answer" property="answer" jdbcType="VARCHAR" />
		<result column="choice_answer_desc" property="answerDesc"
			jdbcType="VARCHAR" />
		<result column="subject" property="subject" jdbcType="INTEGER" />
		<result column="knowledge" property="knowledge" jdbcType="INTEGER" />
		<result column="knowledge_begin" property="knowledgeBegin"
			jdbcType="VARCHAR" />
		<result column="knowledge_end" property="knowledgeEnd"
			jdbcType="VARCHAR" />
		<result column="question_degree" property="degree" jdbcType="INTEGER" />
		<result column="question_type" property="type" jdbcType="INTEGER" />
		<result column="question_source" property="source" jdbcType="INTEGER" />
		<result column="question_score" property="score" jdbcType="FLOAT" />
		<result column="tag_id" property="tag" jdbcType="VARCHAR" />
		<result column="teacher_id" property="teacherId" jdbcType="INTEGER" />
		<result column="used_count" property="useCount" jdbcType="INTEGER" />
		<result column="right_count" property="rightCount" jdbcType="INTEGER" />
		<result column="fault_count" property="faultCount" jdbcType="INTEGER" />
		<result column="ispublic" property="ispublic" jdbcType="INTEGER" />
		<result column="create_time" property="createTime" />
		<result column="update_time" property="updateTime" />
		<result column="is_remove" property="isRemove" jdbcType="INTEGER" />

		<association property="homeworkDetails" javaType="com.db.entity.HomeworkDetails">
			<result column="hd_id" property="hdId" jdbcType="INTEGER" />
			<result column="question_id" property="questionId" jdbcType="INTEGER" />
			<result column="question_type" property="questionType"
				jdbcType="INTEGER" />
			<result column="paper_id" property="paperId" jdbcType="INTEGER" />
			<result column="value" property="value" jdbcType="INTEGER" />
			<result column="create_time" property="createTime" />
			<result column="update_time" property="updateTime" />
			<result column="subject_id" property="subjectId" />
		</association>

		<association property="paperDetails" javaType="com.db.entity.PaperDetails">
			<id column="id" property="id" jdbcType="INTEGER" />
			<result column="question_id" property="questionId" jdbcType="INTEGER" />
			<result column="question_type" property="questionType"
				jdbcType="INTEGER" />
			<result column="paper_id" property="paperId" jdbcType="INTEGER" />
			<result column="value" property="value" jdbcType="INTEGER" />
			<result column="create_time" property="createTime" />
			<result column="update_time" property="updateTime" />
		</association>

		<association property="questionsType" javaType="com.db.entity.QuestionsType">
			<id column="topic_id" property="topicId" jdbcType="INTEGER" />
			<result column="topic_name" property="topicName" jdbcType="VARCHAR" />
			<result column="create_time" property="createTime" />
			<result column="update_time" property="updateTime" />
			<result column="typic_order" property="typicOrder" jdbcType="INTEGER" />
		</association>


		<association property="myMistakes" javaType="com.db.entity.MyMistakes">
			<id column="mistakes_id" property="mistakesId" jdbcType="INTEGER" />
			<result column="student_id" property="studentId" jdbcType="INTEGER" />
			<result column="mistakes_number" property="mistakesNumber"
				jdbcType="INTEGER" />
			<result column="topic_type" property="topicType" jdbcType="INTEGER" />
			<result column="current_mistakes" property="currentMistakes"
				jdbcType="INTEGER" />
			<result column="question_id" property="questionId" jdbcType="INTEGER" />
			<result column="value" property="value" jdbcType="INTEGER" />
			<result column="paper_id" property="paperId" jdbcType="INTEGER" />
			<result column="class_id" property="classId" jdbcType="INTEGER" />
			<result column="create_time" property="createTime" />
		</association>
		<association property="paperAnswer" javaType="com.db.entity.PaperAnswer">
			<id column="answer_id" property="answerId" jdbcType="INTEGER" />
			<result column="paper_id" property="paperId" jdbcType="INTEGER" />
			<result column="write_answer" property="writeAnswer" jdbcType="VARCHAR" />
			<result column="is_true" property="isTrue" jdbcType="INTEGER" />
			<result column="question_type" property="questionType"
				jdbcType="INTEGER" />
		</association>
		<association javaType="com.db.entity.HomeworkAnswer"
			property="homeworkanswer">
			<id column="answer_id" property="answerId" jdbcType="INTEGER" />
			<result column="student_id" property="studentId" jdbcType="INTEGER" />
			<result column="question_id" property="questionId" jdbcType="INTEGER" />
			<result column="question_type" property="questionType"
				jdbcType="INTEGER" />
			<result column="write_answer" property="writeAnswer" jdbcType="VARCHAR" />
			<result column="value" property="value" jdbcType="INTEGER" />
			<result column="paper_id" property="paperId" jdbcType="INTEGER" />
			<result column="is_true" property="isTrue" jdbcType="INTEGER" />
		</association>

		<association property="subject2" javaType="com.db.entity.Subject">
			<id column="subject_id" property="subjectId" jdbcType="INTEGER" />
			<result column="subject_name" property="subjectName" jdbcType="VARCHAR" />
		</association>
		<association property="grade" javaType="com.db.entity.Grade">
			<id column="grade_id" property="gradeId" jdbcType="INTEGER" />
			<result column="grade_name" property="gradeName" jdbcType="VARCHAR" />
		</association>
		
		<association property="teacher" javaType="com.db.entity.Teacher">
			<id column="teacher_id" property="teacherId" jdbcType="INTEGER" />
			<result column="teacher_name" property="teacherName" jdbcType="VARCHAR" />
		</association>
	</resultMap>

	<select id="getQuestionById" resultMap="SingleMap"
		parameterType="Integer">
		select * from tb_question_singlechoice where
		choice_id=#{questionId}
	</select>


	<insert id="addQuestionSingle" parameterType="com.db.entity.QuestionSingleChoice"
		useGeneratedKeys="true" keyProperty="choiceId">
		insert into
		tb_question_singlechoice(choice_desc,choice_optionA,choice_optionB,
		choice_optionC,choice_optionD,choice_answer,subject,knowledge
		,question_degree,question_type,question_source,teacher_id,ispublic,create_time
		<if test="answerDesc!=null and answerDesc!=''">
			<![CDATA[,choice_answer_desc]]>
		</if>
		<if test="score!=null and score!=''">
			<![CDATA[,question_score]]>
		</if>
		<if test="tag!=null and tag!=''">
			<![CDATA[,tag_id]]>
		</if>
		<if test="useCount!=null and useCount!=''">
			<![CDATA[,used_count]]>
		</if>
		<if test="rightCount!=null and rightCount!=''">
			<![CDATA[,right_count]]>
		</if>
		<if test="faultCount!=null and faultCount!=''">
			<![CDATA[,fault_count]]>
		</if>
		<if test="knowledgeBegin !=null and knowledgeBegin !=''">
			<![CDATA[,knowledge_begin]]>
		</if>
		<if test="knowledgeEnd !=null and knowledgeEnd !=''">
			<![CDATA[,knowledge_end]]>
		</if>
		) values
		(#{choiceDesc},#{OptionA},#{OptionB},#{OptionC},#{OptionD},#{answer},#{subject},#{knowledge}
		,#{degree},#{type},#{source},#{teacherId},#{ispublic},#{createTime}
		<if test="answerDesc!=null and answerDesc!=''">
			<![CDATA[,#{answerDesc}]]>
		</if>
		<if test="score!=null and score!=''">
			<![CDATA[,#{score}]]>
		</if>
		<if test="tag!=null and tag!=''">
			<![CDATA[,#{tag}]]>
		</if>
		<if test="useCount!=null and useCount!=''">
			<![CDATA[,#{useCount}]]>
		</if>
		<if test="rightCount!=null and rightCount!=''">
			<![CDATA[,#{rightCount}]]>
		</if>
		<if test="faultCount!=null and faultCount!=''">
			<![CDATA[,#{faultCount}]]>
		</if>
		<if test="knowledgeBegin !=null and knowledgeBegin !=''">
			<![CDATA[,#{knowledgeBegin}]]>
		</if>
		<if test="knowledgeEnd !=null and knowledgeEnd !=''">
			<![CDATA[,#{knowledgeEnd}]]>
		</if>
		)
	</insert>

	<select id="getHomeworkId" resultMap="SingleMap">
		select * from td_homework_details thd right join
		tb_question_singlechoice tqs on
		thd.question_id=tqs.choice_id
		where
		thd.paper_id=#{0} and thd.question_type=#{1} limit #{2},#{3}
		<!-- select * from td_homework_details h left join tb_question_singlechoice 
			q on -->
		<!-- h.question_id=q.choice_id -->
		<!-- where h.paper_id=#{0} limit #{1},#{2} -->
	</select>

	<select id="getSingleChoiceById" parameterType="Integer"
		resultMap="SingleMap">
		select * from tb_question_singlechoice where
		choice_id=#{choiceId};
	</select>
	<!-- 只能拿自己的和别人公开的题目 -->
	<select id="getSingleByRand" resultMap="SingleMap">
		select * from tb_question_singlechoice tqs left join tb_questions_type
		tqt on tqs.question_type=tqt.topic_id
		where
		(tqs.teacher_id=#{teacherId} or tqs.ispublic=1)
		<if test="type!=null and type!=''">
			and tqs.question_type=#{type}
		</if>
		<if test="subject!=null and subject!=''">
			and tqs.subject=#{subject}
		</if>
		<if test="score!=null and score!=''">
			and tqs.question_score=#{score}
		</if>
		<if test="listTag !=null and listTag !=''">
			and tqs.tag_id in
			<foreach collection="listTag" item="listTag" open="("
				separator="," close=")">
				#{listTag}
			</foreach>
		</if>
		<if test="grade !=null">
			and tqs.knowledge=#{grade}
		</if>
		<if test="science !=null">
			and tqs.question_degree=#{science}
		</if>
		order by rand() limit #{number};
	</select>
	<!-- 超级管理员拿全部题目 -->
	<select id="getSingleByRandAdmin" resultMap="SingleMap">
		select * from tb_question_singlechoice tqs left join tb_questions_type
		tqt on tqs.question_type=tqt.topic_id
		where tqs.is_remove &lt;&gt;1
		<if test="type !=null">
			and tqs.question_type=#{type}
		</if>
		<if test="subject!=null">
			and tqs.subject=#{subject}
		</if>
		<choose>
			<when test="tags10!=null">
				and (tqs.tag_id like CONCAT('%','${tags1}','%') or tqs.tag_id like
				CONCAT('%','${tags2}','%')
				or tqs.tag_id like CONCAT('%','${tags3}','%') or tqs.tag_id like
				CONCAT('%','${tags4}','%')
				or tqs.tag_id like CONCAT('%','${tags5}','%') or tqs.tag_id like
				CONCAT('%','${tags6}','%')
				or tqs.tag_id like CONCAT('%','${tags7}','%') or tqs.tag_id like
				CONCAT('%','${tags8}','%')
				or tqs.tag_id like CONCAT('%','${tags9}','%') or tqs.tag_id like
				CONCAT('%','${tags10}','%'))
			</when>
			<when test="tags9!=null and tags10==null">
				and (tqs.tag_id like CONCAT('%','${tags1}','%') or tqs.tag_id like
				CONCAT('%','${tags2}','%')
				or tqs.tag_id like CONCAT('%','${tags3}','%') or tqs.tag_id like
				CONCAT('%','${tags4}','%')
				or tqs.tag_id like CONCAT('%','${tags5}','%') or tqs.tag_id like
				CONCAT('%','${tags6}','%')
				or tqs.tag_id like CONCAT('%','${tags7}','%') or tqs.tag_id like
				CONCAT('%','${tags8}','%')
				or tqs.tag_id like CONCAT('%','${tags9}','%'))
			</when>
			<when test="tags8!=null and tags9==null">
				and (tqs.tag_id like CONCAT('%','${tags1}','%') or tqs.tag_id like
				CONCAT('%','${tags2}','%')
				or tqs.tag_id like CONCAT('%','${tags3}','%') or tqs.tag_id like
				CONCAT('%','${tags4}','%')
				or tqs.tag_id like CONCAT('%','${tags5}','%') or tqs.tag_id like
				CONCAT('%','${tags6}','%')
				or tqs.tag_id like CONCAT('%','${tags7}','%') or tqs.tag_id like
				CONCAT('%','${tags8}','%'))
			</when>
			<when test="tags7!=null and tags8==null">
				and (tqs.tag_id like CONCAT('%','${tags1}','%') or tqs.tag_id like
				CONCAT('%','${tags2}','%')
				or tqs.tag_id like CONCAT('%','${tags3}','%') or tqs.tag_id like
				CONCAT('%','${tags4}','%')
				or tqs.tag_id like CONCAT('%','${tags5}','%') or tqs.tag_id like
				CONCAT('%','${tags6}','%')
				or tqs.tag_id like CONCAT('%','${tags7}','%'))
			</when>
			<when test="tags6!=null and tags7==null">
				and (tqs.tag_id like CONCAT('%','${tags1}','%') or tqs.tag_id like
				CONCAT('%','${tags2}','%')
				or tqs.tag_id like CONCAT('%','${tags3}','%') or tqs.tag_id like
				CONCAT('%','${tags4}','%')
				or tqs.tag_id like CONCAT('%','${tags5}','%') or tqs.tag_id like
				CONCAT('%','${tags6}','%'))
			</when>
			<when test="tags5!=null and tags6==null">
				and (tqs.tag_id like CONCAT('%','${tags1}','%') or tqs.tag_id like
				CONCAT('%','${tags2}','%')
				or tqs.tag_id like CONCAT('%','${tags3}','%') or tqs.tag_id like
				CONCAT('%','${tags4}','%')
				or tqs.tag_id like CONCAT('%','${tags5}','%'))
			</when>
			<when test="tags4!=null and tags5==null">
				and (tqs.tag_id like CONCAT('%','${tags1}','%') or tqs.tag_id like
				CONCAT('%','${tags2}','%')
				or tqs.tag_id like CONCAT('%','${tags3}','%') or tqs.tag_id like
				CONCAT('%','${tags4}','%'))
			</when>
			<when test="tags3!=null and tags4==null">
				and (tqs.tag_id like CONCAT('%','${tags1}','%') or tqs.tag_id like
				CONCAT('%','${tags2}','%')
				or tqs.tag_id like CONCAT('%','${tags3}','%'))
			</when>
			<when test="tags2!=null and tags3==null">
				and (tqs.tag_id like CONCAT('%','${tags1}','%') or tqs.tag_id like
				CONCAT('%','${tags2}','%'))
			</when>
			<when test="tags1!=null and tags2==null">
				and tqs.tag_id like CONCAT('%','${tags1}','%')
			</when>
		</choose>
		<if test="grade !=null">
			and tqs.knowledge=#{grade}
		</if>
		<if test="science !=null">
			and tqs.question_degree=#{science}
		</if>
		order by rand() limit #{number};
	</select>


	<select id="getSingleByRandAdminIsPublic" resultMap="SingleMap">
		select * from tb_question_singlechoice tqs left join tb_questions_type
		tqt on tqs.question_type=tqt.topic_id
		where (tqs.teacher_id=#{teacherId} or tqs.ispublic=1) and tqs.is_remove
		&lt;&gt;1
		<if test="type!=null">
			and tqs.question_type=#{type}
		</if>
		<if test="subject!=null">
			and tqs.subject=#{subject}
		</if>
		<choose>
			<when test="tags10!=null">
				and (tqs.tag_id like CONCAT('%','${tags1}','%') or tqs.tag_id like
				CONCAT('%','${tags2}','%')
				or tqs.tag_id like CONCAT('%','${tags3}','%') or tqs.tag_id like
				CONCAT('%','${tags4}','%')
				or tqs.tag_id like CONCAT('%','${tags5}','%') or tqs.tag_id like
				CONCAT('%','${tags6}','%')
				or tqs.tag_id like CONCAT('%','${tags7}','%') or tqs.tag_id like
				CONCAT('%','${tags8}','%')
				or tqs.tag_id like CONCAT('%','${tags9}','%') or tqs.tag_id like
				CONCAT('%','${tags10}','%'))
			</when>
			<when test="tags9!=null and tags10==null">
				and (tqs.tag_id like CONCAT('%','${tags1}','%') or tqs.tag_id like
				CONCAT('%','${tags2}','%')
				or tqs.tag_id like CONCAT('%','${tags3}','%') or tqs.tag_id like
				CONCAT('%','${tags4}','%')
				or tqs.tag_id like CONCAT('%','${tags5}','%') or tqs.tag_id like
				CONCAT('%','${tags6}','%')
				or tqs.tag_id like CONCAT('%','${tags7}','%') or tqs.tag_id like
				CONCAT('%','${tags8}','%')
				or tqs.tag_id like CONCAT('%','${tags9}','%'))
			</when>
			<when test="tags8!=null and tags9==null">
				and (tqs.tag_id like CONCAT('%','${tags1}','%') or tqs.tag_id like
				CONCAT('%','${tags2}','%')
				or tqs.tag_id like CONCAT('%','${tags3}','%') or tqs.tag_id like
				CONCAT('%','${tags4}','%')
				or tqs.tag_id like CONCAT('%','${tags5}','%') or tqs.tag_id like
				CONCAT('%','${tags6}','%')
				or tqs.tag_id like CONCAT('%','${tags7}','%') or tqs.tag_id like
				CONCAT('%','${tags8}','%'))
			</when>
			<when test="tags7!=null and tags8==null">
				and (tqs.tag_id like CONCAT('%','${tags1}','%') or tqs.tag_id like
				CONCAT('%','${tags2}','%')
				or tqs.tag_id like CONCAT('%','${tags3}','%') or tqs.tag_id like
				CONCAT('%','${tags4}','%')
				or tqs.tag_id like CONCAT('%','${tags5}','%') or tqs.tag_id like
				CONCAT('%','${tags6}','%')
				or tqs.tag_id like CONCAT('%','${tags7}','%'))
			</when>
			<when test="tags6!=null and tags7==null">
				and (tqs.tag_id like CONCAT('%','${tags1}','%') or tqs.tag_id like
				CONCAT('%','${tags2}','%')
				or tqs.tag_id like CONCAT('%','${tags3}','%') or tqs.tag_id like
				CONCAT('%','${tags4}','%')
				or tqs.tag_id like CONCAT('%','${tags5}','%') or tqs.tag_id like
				CONCAT('%','${tags6}','%'))
			</when>
			<when test="tags5!=null and tags6==null">
				and (tqs.tag_id like CONCAT('%','${tags1}','%') or tqs.tag_id like
				CONCAT('%','${tags2}','%')
				or tqs.tag_id like CONCAT('%','${tags3}','%') or tqs.tag_id like
				CONCAT('%','${tags4}','%')
				or tqs.tag_id like CONCAT('%','${tags5}','%'))
			</when>
			<when test="tags4!=null and tags5==null">
				and (tqs.tag_id like CONCAT('%','${tags1}','%') or tqs.tag_id like
				CONCAT('%','${tags2}','%')
				or tqs.tag_id like CONCAT('%','${tags3}','%') or tqs.tag_id like
				CONCAT('%','${tags4}','%'))
			</when>
			<when test="tags3!=null and tags4==null">
				and (tqs.tag_id like CONCAT('%','${tags1}','%') or tqs.tag_id like
				CONCAT('%','${tags2}','%')
				or tqs.tag_id like CONCAT('%','${tags3}','%'))
			</when>
			<when test="tags2!=null and tags3==null">
				and (tqs.tag_id like CONCAT('%','${tags1}','%') or tqs.tag_id like
				CONCAT('%','${tags2}','%'))
			</when>
			<when test="tags1!=null and tags2==null">
				and tqs.tag_id like CONCAT('%','${tags1}','%')
			</when>
		</choose>
		<if test="grade !=null">
			and tqs.knowledge=#{grade}
		</if>
		<if test="science !=null">
			and tqs.question_degree=#{science}
		</if>
		order by rand() limit #{number};
	</select>

	<select id="getSingleByTeacherId" parameterType="Integer"
		resultMap="SingleMap">
		select * from tb_question_singlechoice qs 
		left join tb_teacher t on qs.teacher_id=t.teacher_id
		left join tb_subject s on qs.subject=s.subject_id 
		left join tb_grade g on qs.knowledge=g.grade_id
		where qs.teacher_id=#{teacherId} and
		qs.is_remove &lt;&gt;1
		<if test="handoutType != null and handoutType != ''">
			and qs.question_type=#{handoutType}
		</if>
		<if test="subject != null and subject != ''">
			and qs.subject=#{subject}
		</if>

		<if test="questionDegree != null and questionDegree != ''">
			and qs.question_degree=#{questionDegree}
		</if>
		<if test="tagId !=null and tagId !=''">
			and qs.tag_id REGEXP '(^|,)${tagId}($|,)'
		</if>
		<if test="isPublic != null">
			and qs.ispublic=#{isPublic}
		</if>
		<if test="gradeId != null">
		and qs.knowledge=#{gradeId}
	</if>
		order by qs.create_time desc limit #{pageNo},#{pageSize}
	</select>

	<select id="getSingleByTeacherIdIsPublicbyIds" parameterType="Integer"
		resultMap="SingleMap">
		select * from tb_question_singlechoice qs 
		left join tb_subject s on qs.subject=s.subject_id
		left join tb_teacher t on qs.teacher_id=t.teacher_id 
		left join tb_grade g on qs.knowledge=g.grade_id
		where (qs.teacher_id=#{teacherId} or qs.ispublic=1) and qs.is_remove
		&lt;&gt;1
		<if test="handoutType != null">
			and qs.question_type=#{handoutType}
		</if>
		<if test="subject != null">
			and qs.subject=#{subject}
		</if>
		<if test="questionDegree != null">
			and qs.question_degree=#{questionDegree}
		</if>
		<if test="tagId != null">
			and qs.tag_id REGEXP '(^|,)${tagId}($|,)'
		</if>
		<if test="isPublic != null">
			and qs.ispublic=#{isPublic}
		</if>
		<if test="gradelist != null">
			and knowledge in
			<foreach collection="gradelist" item="item" open="(" separator="," close=")">		
			#{item.gradeId}
		</foreach>
		</if>
		order by qs.create_time desc limit #{pageNo},#{pageSize}
	</select>

	<select id="getSingleByTeacherIdIsPublic" parameterType="Integer"
		resultMap="SingleMap">
		select * from tb_question_singlechoice qs 
		left join tb_subject s on qs.subject=s.subject_id
		left join tb_teacher t on qs.teacher_id=t.teacher_id 
		left join tb_grade g on qs.knowledge=g.grade_id
		where (qs.teacher_id=#{teacherId} or qs.ispublic=1) and qs.is_remove
		&lt;&gt;1
		<if test="handoutType != null">
			and qs.question_type=#{handoutType}
		</if>
		<if test="subject != null">
			and qs.subject=#{subject}
		</if>
		<if test="questionDegree != null">
			and qs.question_degree=#{questionDegree}
		</if>
		<if test="tagId != null">
			and qs.tag_id REGEXP '(^|,)${tagId}($|,)'
		</if>
		<if test="isPublic != null">
			and qs.ispublic=#{isPublic}
		</if>
		<if test="gradeId != null">
			and qs.knowledge=#{gradeId}
		</if>
		order by qs.create_time desc limit #{pageNo},#{pageSize}
	</select>


	<update id="deleteQuestionSingle" parameterType="com.db.entity.QuestionSingleChoice">

		update tb_question_singlechoice set is_remove=1 where choice_id=#{choiceId};
	</update>

	<select id="thePapersById" resultMap="SingleMap">
		select * from
		tb_paper_details mp right join tb_question_singlechoice qs on
		mp.question_id=qs.choice_id LEFT JOIN tb_questions_type qt ON
		mp.question_type=qt.topic_id
		where mp.paper_id=#{paperId} and
		mp.question_type=1  
		<if test="pageNo != null and pageSize != null">
		limit #{pageNo},#{pageSize}
		</if>
	</select>
	<select id="theHomeworkById" resultMap="SingleMap">
		select * from
		td_homework_details thd right join tb_question_singlechoice qs on
		thd.question_id=qs.choice_id
		where thd.paper_id=#{paperId} and
		thd.question_type=#{type} 
		<if test="pageNo != null and pageSize != null">
		limit #{pageNo},#{pageSize}
		</if>
	</select>
	<select id="findHomeworkDetails" resultMap="SingleMap">
		select * from
		td_homework_details h left join tb_question_singlechoice q on
		h.question_id=q.choice_id
		where h.paper_id=#{paperId} and
		h.question_type=1
	</select>

	<select id="findPaperInfoDetails" resultMap="SingleMap">
		select * from
		tb_paper_details h left join tb_question_singlechoice q on
		h.question_id=q.choice_id
		where h.paper_id=#{paperId} and
		h.question_type=1
	</select>

	<select id="getconut" resultType="Integer">
		select count(*) from
		tb_question_singlechoice where
		teacher_id=#{teacherId} and is_remove &lt;&gt;1
		<if test="handoutType != null and handoutType != ''">
			and question_type=#{handoutType}
		</if>
		<if test="subject != null and subject != ''">
			and subject=#{subject}
		</if>

		<if test="questionDegree != null and questionDegree != ''">
	and question_degree=#{questionDegree}
</if>

	<if test="isPublic != null">
		and ispublic=#{isPublic}
	</if>
	<if test="gradeId != null">
		and knowledge=#{gradeId}
	</if>
	</select>

	<select id="getconutIspublic" resultType="Integer">
		select count(*) from
		tb_question_singlechoice where
		(teacher_id=#{teacherId} or ispublic=1) and is_remove &lt;&gt;1
		<if test="handoutType != null">
			and question_type=#{handoutType}
		</if>
		<if test="subject != null">
			and subject=#{subject}
		</if>
		<if test="questionDegree != null">
			and question_degree=#{questionDegree}
		</if>
		<if test="tagId != null">
			and tag_id REGEXP '(^|,)${tagId}($|,)'
		</if>
		<if test="isPublic != null">
			and ispublic=#{isPublic}
		</if>
		<if test="gradeId != null">
			and knowledge=#{gradeId}
		</if>
	</select>
	
	<select id="getconutIspublicbyIds" resultType="Integer">
		select count(*) from
		tb_question_singlechoice where
		(teacher_id=#{teacherId} or ispublic=1) and is_remove &lt;&gt;1
		<if test="handoutType != null">
			and question_type=#{handoutType}
		</if>
		<if test="subject != null">
			and subject=#{subject}
		</if>
		<if test="questionDegree != null">
			and question_degree=#{questionDegree}
		</if>
		<if test="tagId != null">
			and tag_id REGEXP '(^|,)${tagId}($|,)'
		</if>
		<if test="isPublic != null">
			and ispublic=#{isPublic}
		</if>
		<!-- by zhangzhaojian -->
		<if test="gradelist != null">
			and knowledge in
			<foreach collection="gradelist" item="item" open="(" separator="," close=")">		
			#{item.gradeId}
		</foreach>
		</if>
	</select>

	<select id="errorParsinDetails" resultMap="SingleMap">
		select *
		from
		tb_my_mistakes mp left join tb_question_singlechoice qsc on
		mp.question_id=qsc.choice_id

		where mp.student_id=#{studentId} and
		mp.question_id=#{questionId}
	</select>
	<select id="thePapersAnswerById" resultMap="SingleMap">
		SELECT * FROM
		td_paper_answer pa LEFT JOIN tb_questions_type qt ON
		pa.question_type=qt.topic_id
		RIGHT JOIN tb_question_singlechoice qs ON
		pa.question_id=qs.choice_id
		WHERE pa.student_id=#{0} AND
		pa.paper_id=#{1} AND pa.question_type=#{2}
		limit #{3},#{4}
	</select>
	<select id="theHomeworkAnswerById" resultMap="SingleMap">
		SELECT * FROM
		td_homework_answer pa LEFT JOIN tb_questions_type qt ON
		pa.question_type=qt.topic_id
		RIGHT JOIN tb_question_singlechoice qs ON
		pa.question_id=qs.choice_id
		WHERE pa.student_id=#{0} AND
		pa.paper_id=#{1} AND pa.question_type=#{2}
		limit #{3},#{4}
	</select>


	<update id="updateIspublic" parameterType="com.db.entity.QuestionSingleChoice">
		update
		tb_question_singlechoice set
		ispublic=#{ispublic},update_time=#{updateTime} where
		choice_id=#{choiceId};
	</update>
	<update id="updateUsecount" parameterType="com.db.entity.QuestionSingleChoice">
		update
		tb_question_singlechoice set
		used_count=#{useCount},update_time=#{updateTime} where
		choice_id=#{choiceId};
	</update>
	<update id="updateQuestion" parameterType="com.db.entity.QuestionSingleChoice">
		update tb_question_singlechoice
		<set>
			update_time=#{updateTime}
			<if test="choiceDesc !=null and choiceDesc !=''">
				,choice_desc=#{choiceDesc}
			</if>
			<if test="OptionA !=null and OptionA !=''">
				,choice_optionA=#{OptionA}
			</if>
			<if test="OptionB !=null and OptionB !=''">
				,choice_optionB=#{OptionB}
			</if>
			<if test="OptionC !=null and OptionC !=''">
				,choice_optionC=#{OptionC}
			</if>
			<if test="OptionD !=null and OptionD !=''">
				,choice_optionD=#{OptionD}
			</if>
			<if test="answer !=null and answer !=''">
				,choice_answer=#{answer}
			</if>
			<if test="answerDesc !=null and answerDesc !=''">
				,choice_answer_desc=#{answerDesc}
			</if>
			<if test="subject !=null and subject !=''">
				,subject=#{subject}
			</if>
			<if test="knowledge !=null and knowledge !=''">
				,knowledge=#{knowledge}
			</if>
			<if test="knowledgeBegin !=null and knowledgeBegin !=''">
				,knowledge_begin=#{knowledgeBegin}
			</if>
			<if test="knowledgeEnd !=null and knowledgeEnd !=''">
				,knowledge_end=#{knowledgeEnd}
			</if>
			<if test="degree !=null and degree !=''">
				,question_degree=#{degree}
			</if>
			<if test="type !=null and type !=''">
				,question_type=#{type}
			</if>
			<if test="source !=null and source !=''">
				,question_source=#{source}
			</if>
			<if test="score !=null and score !=''">
				,question_score=#{score}
			</if>
			<if test="tag !=null and tag !=''">
				,tag_id=#{tag}
			</if>
		</set>
		where choice_id=#{choiceId}
	</update>
	<select id="getTageId" resultMap="SingleMap">
		select * from tb_question_singlechoice where tag_id like
		CONCAT('%','${tagId}','%') and is_remove &lt;&gt;1

	</select>
	<select id="getQuestionSource" resultMap="SingleMap">
		select * from tb_question_singlechoice where question_source=#{sourceId} and
		is_remove &lt;&gt;1
	</select>
	<select id="getknowledgeBegin" resultMap="SingleMap">
		select * from tb_question_singlechoice where is_remove &lt;&gt;1 and
		knowledge_begin=#{lessonId} or knowledge_end=#{lessonId}
	</select>
	<select id="getAllQuestionsCount" resultType="int">
		select count(*) from tb_question_singlechoice where is_remove
		&lt;&gt;1
		<if test="handoutType != null">
			and question_type=#{handoutType}
		</if>
		<if test="subject != null ">
			and subject=#{subject}
		</if>
		<if test="questionDegree != null ">
			and question_degree=#{questionDegree}
		</if>
		<if test="tagId != null">
			and tag_id REGEXP '(^|,)${tagId}($|,)'
		</if>
		<if test="isPublic != null">
			and ispublic=#{isPublic}
		</if>
		<if test="gradeId != null">
			and knowledge=#{gradeId}
		</if>
	</select>
	<select id="getAllQuestions" resultMap="SingleMap">
		select * from tb_question_singlechoice qs 
		left join tb_subject s on qs.subject=s.subject_id 
		left join tb_teacher t on qs.teacher_id=t.teacher_id
		left join tb_grade g on qs.knowledge=g.grade_id
		where is_remove &lt;&gt;1
		<if test="handoutType != null and handoutType != ''">
			and qs.question_type=#{handoutType}
		</if>
		<if test="subject != null and subject != ''">
			and qs.subject=#{subject}
		</if>
		<if test="questionDegree != null and questionDegree != ''">
			and qs.question_degree=#{questionDegree}
		</if>
		<if test="tagId != null">
			and qs.tag_id REGEXP '(^|,)${tagId}($|,)'
		</if>
		<if test="isPublic != null">
			and qs.ispublic=#{isPublic}
		</if>
		<if test="gradeId != null">
			and qs.knowledge=#{gradeId}
		</if>
		order by qs.create_time desc limit #{pageNo},#{pageSize}
	</select>
	<select id="getSubjectById" resultMap="SingleMap">
		select * from tb_question_singlechoice where subject=#{subjectId}
	</select>
	<!--防止添加题目时点击多次  -->
	<select id="getQuestionSingleChoiceTitle" resultMap="SingleMap">
	select * from tb_question_singlechoice where choice_desc=#{choiceDesc}
	</select>
</mapper>