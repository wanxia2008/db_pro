<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.db.service.QuestionJudgeService">
	<resultMap id="JudgeMap" type="com.db.entity.QuestionJudge">
		<result column="judge_id" property="judgeId" jdbcType="INTEGER" />
		<result column="judge_desc" property="judgeDesc" jdbcType="VARCHAR" />
		<result column="judge_answer" property="answer2" jdbcType="INTEGER" />
		<result column="judge_answer_desc" property="answerDesc2"
			jdbcType="VARCHAR" />
		<result column="subject" property="subject" jdbcType="INTEGER" />
		<result column="knowledge" property="knowledge" jdbcType="INTEGER" />
		<result column="knowledge_begin" property="knowledgeBegin"
			jdbcType="VARCHAR" />
		<result column="knowledge_end" property="knowledgeEnd"
			jdbcType="VARCHAR" />
		<result column="question_degree" property="degree2" jdbcType="INTEGER" />
		<result column="question_type" property="type" jdbcType="INTEGER" />
		<result column="question_source" property="source2" jdbcType="INTEGER" />
		<result column="question_score" property="score2" jdbcType="FLOAT" />
		<result column="tag_id" property="tag2" jdbcType="VARCHAR" />
		<result column="teacher_id" property="teacherId" jdbcType="INTEGER" />
		<result column="used_count" property="useCount" jdbcType="INTEGER" />
		<result column="right_count" property="rightCount" jdbcType="INTEGER" />
		<result column="fault_count" property="faultCount" jdbcType="INTEGER" />
		<result column="ispublic" property="ispublic2" jdbcType="INTEGER" />
		<result column="create_time" property="createTime" />
		<result column="update_time" property="updateTime" />
		<result column="is_remove" property="isRemove" jdbcType="INTEGER" />
		<!-- 1 -->
		<association property="paperDetails" javaType="com.db.entity.PaperDetails">
			<id property="id" column="id" />
			<result property="questionId" column="question_id" />
			<result property="paperId" column="paper_id" />
			<result property="value" column="value" />
			<result property="number" column="number" />
			<result property="createTime" column="create_time" />
			<result property="paperType" column="paper_type" />
		</association>
		<!-- 2 -->
		<association property="homeworkDetails" javaType="com.db.entity.HomeworkDetails">
			<id property="hdId" column="hd_id" />
			<result column="question_id" property="questionId" jdbcType="INTEGER" />
			<result column="question_type" property="questionType"
				jdbcType="INTEGER" />
			<result column="paper_id" property="paperId" jdbcType="INTEGER" />
			<result column="value" property="value" jdbcType="INTEGER" />
			<result column="create_time" property="createTime" />
			<result column="update_time" property="updateTime" />
		</association>

		<association property="myMistakes" javaType="com.db.entity.MyMistakes">
			<id column="mistakes_id" property="mistakesId" jdbcType="INTEGER" />
			<result column="student_id" property="studentId" jdbcType="INTEGER" />
			<result column="mistakes_number" property="mistakesNumber"
				jdbcType="INTEGER" />
			<result column="topic_type" property="topicType" jdbcType="INTEGER" />
			<result column="current_mistakes" property="currentMistakes"
				jdbcType="INTEGER" />
			<result column="question_id" property="questionId" jdbcType="INTEGER" />
			<result column="value" property="value" jdbcType="INTEGER" />
			<result column="paper_id" property="paperId" jdbcType="INTEGER" />
			<result column="create_time" property="createTime" />
		</association>

		<association property="questionsType" javaType="com.db.entity.QuestionsType">
			<id column="topic_id" property="topicId" jdbcType="INTEGER" />
			<result column="topic_name" property="topicName" jdbcType="VARCHAR" />
			<result column="create_time" property="createTime" />
			<result column="update_time" property="updateTime" />
			<result column="typic_order" property="typicOrder" jdbcType="INTEGER" />
		</association>
		<association property="paperAnswer" javaType="com.db.entity.PaperAnswer">
			<id column="answer_id" property="answerId" jdbcType="INTEGER" />
			<result column="paper_id" property="paperId" jdbcType="INTEGER" />
			<result column="write_answer" property="writeAnswer" jdbcType="VARCHAR" />
			<result column="is_true" property="isTrue" jdbcType="INTEGER" />
			<result column="question_type" property="questionType"
				jdbcType="INTEGER" />
		</association>
		<association javaType="com.db.entity.HomeworkAnswer"
			property="homeworkanswer">
			<id column="answer_id" property="answerId" jdbcType="INTEGER" />
			<result column="student_id" property="studentId" jdbcType="INTEGER" />
			<result column="question_id" property="questionId" jdbcType="INTEGER" />
			<result column="question_type" property="questionType"
				jdbcType="INTEGER" />
			<result column="write_answer" property="writeAnswer" jdbcType="VARCHAR" />
			<result column="value" property="value" jdbcType="INTEGER" />
			<result column="paper_id" property="paperId" jdbcType="INTEGER" />
			<result column="is_true" property="isTrue" jdbcType="INTEGER" />
		</association>

		<association property="subject2" javaType="com.db.entity.Subject">
			<id column="subject_id" property="subjectId" jdbcType="INTEGER" />
			<result column="subject_name" property="subjectName" jdbcType="VARCHAR" />
		</association>
		
		<association property="grade" javaType="com.db.entity.Grade">
			<id column="grade_id" property="gradeId" jdbcType="INTEGER" />
			<result column="grade_name" property="gradeName" jdbcType="VARCHAR" />
		</association>
		
		<association property="teacher" javaType="com.db.entity.Teacher">
			<id column="teacher_id" property="teacherId" jdbcType="INTEGER" />
			<result column="teacher_name" property="teacherName" jdbcType="VARCHAR" />
		</association>
	</resultMap>

	<select id="getQuestionJudgeById" resultMap="JudgeMap">
		select * from
		tb_paper_details p left join tb_question_judge q on
		p.question_id=q.judge_id
		where p.paper_id=#{0} limit #{1},#{2}
	</select>
	<select id="getHomework" resultMap="JudgeMap">
		select * from td_homework_details thd right join tb_question_judge tqj
		on
		thd.question_id=tqj.judge_id
		where thd.paper_id=#{0} and
		thd.question_type=#{1} limit #{2},#{3}
		<!-- select * from td_homework_details h left join tb_question_judge q 
			on -->
		<!-- h.question_id=q.judge_id -->
		<!-- where h.student_id=#{0} limit #{1},#{2} -->
	</select>

	<insert id="addQuestionJudge" parameterType="com.db.entity.QuestionJudge"
		useGeneratedKeys="true" keyProperty="judgeId">
		insert into
		tb_question_judge(judge_desc,judge_answer,subject,knowledge,
		question_degree,question_type,
		question_source,teacher_id,ispublic,create_time
		<if test="answerDesc2!=null and answerDesc2!=''">
			<![CDATA[,judge_answer_desc]]>
		</if>
		<if test="score2!=null and score2!=''">
			<![CDATA[,question_score]]>
		</if>
		<if test="tag2!=null and tag2!=''">
			<![CDATA[,tag_id]]>
		</if>
		<if test="useCount!=null and useCount!=''">
			<![CDATA[,used_count]]>
		</if>
		<if test="rightCount!=null and rightCount!=''">
			<![CDATA[,right_count]]>
		</if>
		<if test="faultCount!=null and faultCount!=''">
			<![CDATA[,fault_count]]>
		</if>
		<if test="knowledgeBegin !=null and knowledgeBegin !=''">
			<![CDATA[,knowledge_begin]]>
		</if>
		<if test="knowledgeEnd !=null and knowledgeEnd !=''">
			<![CDATA[,knowledge_end]]>
		</if>
		) values
		(#{judgeDesc},#{answer2},#{subject},#{knowledge},
		#{degree2},#{type},#{source2},#{teacherId},#{ispublic2},#{createTime}
		<if test="answerDesc2!=null and answerDesc2!=''">
			<![CDATA[,#{answerDesc2}]]>
		</if>
		<if test="score2!=null and score2!=''">
			<![CDATA[,#{score2}]]>
		</if>
		<if test="tag2!=null and tag2!=''">
			<![CDATA[,#{tag2}]]>
		</if>
		<if test="useCount!=null and useCount!=''">
			<![CDATA[,#{useCount}]]>
		</if>
		<if test="rightCount!=null and rightCount!=''">
			<![CDATA[,#{rightCount}]]>
		</if>
		<if test="faultCount!=null and faultCount!=''">
			<![CDATA[,#{faultCount}]]>
		</if>
		<if test="knowledgeBegin !=null and knowledgeBegin !=''">
			<![CDATA[,#{knowledgeBegin}]]>
		</if>
		<if test="knowledgeEnd !=null and knowledgeEnd !=''">
			<![CDATA[,#{knowledgeEnd}]]>
		</if>
		)
	</insert>

	<select id="getJudgeById" parameterType="com.db.entity.QuestionJudge"
		resultMap="JudgeMap">
		select * from tb_question_judge where judge_id=#{judgeId};
	</select>

	<!-- 只能拿自己和别人公开的题目 -->
	<select id="getJudgeByRand" resultMap="JudgeMap">
		select * from tb_question_judge tqj left join tb_questions_type tqt on
		tqj.question_type=tqt.topic_id
		<where>
			(tqj.teacher_id=#{teacherId} or tqj.ispublic=1)
			<if test="type!=null and type!=''">
				and tqj.question_type=#{type}
			</if>
			<if test="subject!=null and subject!=''">
				and tqj.subject=#{subject}
			</if>
			<if test="score!=null and score!=''">
				and tqj.question_score=#{score}
			</if>
			<if test="listTag !=null and listTag !=''">
				and tqj.tag_id in
				<foreach collection="listTag" item="listTag" open="("
					separator="," close=")">
					#{listTag}
				</foreach>
			</if>
			<if test="grade !=null">
				and tqj.knowledge=#{grade}
			</if>
			<if test="science !=null">
				and tqj.question_degree=#{science}
			</if>
		</where>
		order by rand() limit #{number};
	</select>

	<!-- 拿全部的题目 -->
	<select id="getJudgeByRandAdmin" resultMap="JudgeMap">
		select * from tb_question_judge tqj left join tb_questions_type tqt on
		tqj.question_type=tqt.topic_id
		where tqj.is_remove &lt;&gt;1
		<if test="type!=null and type!=''">
			and tqj.question_type=#{type}
		</if>
		<if test="subject!=null and subject!=''">
			and tqj.subject=#{subject}
		</if>
		<choose>
			<when test="tags10!=null">
				AND (tqj.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqj.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqj.tag_id LIKE
				CONCAT('%','${tags3}','%') OR tqj.tag_id LIKE
				CONCAT('%','${tags4}','%')
				OR tqj.tag_id LIKE
				CONCAT('%','${tags5}','%') OR tqj.tag_id LIKE
				CONCAT('%','${tags6}','%')
				OR tqj.tag_id LIKE
				CONCAT('%','${tags7}','%') OR tqj.tag_id LIKE
				CONCAT('%','${tags8}','%')
				OR tqj.tag_id LIKE
				CONCAT('%','${tags9}','%') OR tqj.tag_id LIKE
				CONCAT('%','${tags10}','%'))
			</when>
			<when test="tags9!=null and tags10==null">
				AND (tqj.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqj.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqj.tag_id LIKE
				CONCAT('%','${tags3}','%') OR tqj.tag_id LIKE
				CONCAT('%','${tags4}','%')
				OR tqj.tag_id LIKE
				CONCAT('%','${tags5}','%') OR tqj.tag_id LIKE
				CONCAT('%','${tags6}','%')
				OR tqj.tag_id LIKE
				CONCAT('%','${tags7}','%') OR tqj.tag_id LIKE
				CONCAT('%','${tags8}','%')
				OR tqj.tag_id LIKE
				CONCAT('%','${tags9}','%'))
			</when>
			<when test="tags8!=null and tags9==null">
				AND (tqj.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqj.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqj.tag_id LIKE
				CONCAT('%','${tags3}','%') OR tqj.tag_id LIKE
				CONCAT('%','${tags4}','%')
				OR tqj.tag_id LIKE
				CONCAT('%','${tags5}','%') OR tqj.tag_id LIKE
				CONCAT('%','${tags6}','%')
				OR tqj.tag_id LIKE
				CONCAT('%','${tags7}','%') OR tqj.tag_id LIKE
				CONCAT('%','${tags8}','%'))
			</when>
			<when test="tags7!=null and tags8==null">
				AND (tqj.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqj.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqj.tag_id LIKE
				CONCAT('%','${tags3}','%') OR tqj.tag_id LIKE
				CONCAT('%','${tags4}','%')
				OR tqj.tag_id LIKE
				CONCAT('%','${tags5}','%') OR tqj.tag_id LIKE
				CONCAT('%','${tags6}','%')
				OR tqj.tag_id LIKE
				CONCAT('%','${tags7}','%'))
			</when>
			<when test="tags6!=null and tags7==null">
				AND (tqj.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqj.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqj.tag_id LIKE
				CONCAT('%','${tags3}','%') OR tqj.tag_id LIKE
				CONCAT('%','${tags4}','%')
				OR tqj.tag_id LIKE
				CONCAT('%','${tags5}','%') OR tqj.tag_id LIKE
				CONCAT('%','${tags6}','%'))
			</when>
			<when test="tags5!=null and tags6==null">
				AND (tqj.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqj.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqj.tag_id LIKE
				CONCAT('%','${tags3}','%') OR tqj.tag_id LIKE
				CONCAT('%','${tags4}','%')
				OR tqj.tag_id LIKE
				CONCAT('%','${tags5}','%'))
			</when>
			<when test="tags4!=null and tags5==null">
				AND (tqj.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqj.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqj.tag_id LIKE
				CONCAT('%','${tags3}','%') OR tqj.tag_id LIKE
				CONCAT('%','${tags4}','%'))
			</when>
			<when test="tags3!=null and tags4==null">
				AND (tqj.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqj.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqj.tag_id LIKE
				CONCAT('%','${tags3}','%'))
			</when>
			<when test="tags2!=null and tags3==null">
				AND (tqj.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqj.tag_id LIKE
				CONCAT('%','${tags2}','%'))
			</when>
			<when test="tags1!=null and tags2==null">
				AND tqj.tag_id LIKE CONCAT('%','${tags1}','%')
			</when>
		</choose>
		<if test="grade !=null">
			and tqj.knowledge=#{grade}
		</if>
		<if test="science !=null">
			and tqj.question_degree=#{science}
		</if>
		order by rand() limit #{number};
	</select>

	<select id="getJudgeByRandAdminIsPublic" resultMap="JudgeMap">
		select * from tb_question_judge tqj left join tb_questions_type tqt on
		tqj.question_type=tqt.topic_id
		where (tqj.teacher_id=#{teacherId} or tqj.ispublic=1) and tqj.is_remove
		&lt;&gt;1
		<if test="type!=null and type!=''">
			and tqj.question_type=#{type}
		</if>
		<if test="subject!=null and subject!=''">
			and tqj.subject=#{subject}
		</if>
				<choose>
			<when test="tags10!=null">
				AND (tqj.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqj.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqj.tag_id LIKE
				CONCAT('%','${tags3}','%') OR tqj.tag_id LIKE
				CONCAT('%','${tags4}','%')
				OR tqj.tag_id LIKE
				CONCAT('%','${tags5}','%') OR tqj.tag_id LIKE
				CONCAT('%','${tags6}','%')
				OR tqj.tag_id LIKE
				CONCAT('%','${tags7}','%') OR tqj.tag_id LIKE
				CONCAT('%','${tags8}','%')
				OR tqj.tag_id LIKE
				CONCAT('%','${tags9}','%') OR tqj.tag_id LIKE
				CONCAT('%','${tags10}','%'))
			</when>
			<when test="tags9!=null and tags10==null">
				AND (tqj.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqj.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqj.tag_id LIKE
				CONCAT('%','${tags3}','%') OR tqj.tag_id LIKE
				CONCAT('%','${tags4}','%')
				OR tqj.tag_id LIKE
				CONCAT('%','${tags5}','%') OR tqj.tag_id LIKE
				CONCAT('%','${tags6}','%')
				OR tqj.tag_id LIKE
				CONCAT('%','${tags7}','%') OR tqj.tag_id LIKE
				CONCAT('%','${tags8}','%')
				OR tqj.tag_id LIKE
				CONCAT('%','${tags9}','%'))
			</when>
			<when test="tags8!=null and tags9==null">
				AND (tqj.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqj.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqj.tag_id LIKE
				CONCAT('%','${tags3}','%') OR tqj.tag_id LIKE
				CONCAT('%','${tags4}','%')
				OR tqj.tag_id LIKE
				CONCAT('%','${tags5}','%') OR tqj.tag_id LIKE
				CONCAT('%','${tags6}','%')
				OR tqj.tag_id LIKE
				CONCAT('%','${tags7}','%') OR tqj.tag_id LIKE
				CONCAT('%','${tags8}','%'))
			</when>
			<when test="tags7!=null and tags8==null">
				AND (tqj.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqj.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqj.tag_id LIKE
				CONCAT('%','${tags3}','%') OR tqj.tag_id LIKE
				CONCAT('%','${tags4}','%')
				OR tqj.tag_id LIKE
				CONCAT('%','${tags5}','%') OR tqj.tag_id LIKE
				CONCAT('%','${tags6}','%')
				OR tqj.tag_id LIKE
				CONCAT('%','${tags7}','%'))
			</when>
			<when test="tags6!=null and tags7==null">
				AND (tqj.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqj.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqj.tag_id LIKE
				CONCAT('%','${tags3}','%') OR tqj.tag_id LIKE
				CONCAT('%','${tags4}','%')
				OR tqj.tag_id LIKE
				CONCAT('%','${tags5}','%') OR tqj.tag_id LIKE
				CONCAT('%','${tags6}','%'))
			</when>
			<when test="tags5!=null and tags6==null">
				AND (tqj.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqj.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqj.tag_id LIKE
				CONCAT('%','${tags3}','%') OR tqj.tag_id LIKE
				CONCAT('%','${tags4}','%')
				OR tqj.tag_id LIKE
				CONCAT('%','${tags5}','%'))
			</when>
			<when test="tags4!=null and tags5==null">
				AND (tqj.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqj.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqj.tag_id LIKE
				CONCAT('%','${tags3}','%') OR tqj.tag_id LIKE
				CONCAT('%','${tags4}','%'))
			</when>
			<when test="tags3!=null and tags4==null">
				AND (tqj.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqj.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqj.tag_id LIKE
				CONCAT('%','${tags3}','%'))
			</when>
			<when test="tags2!=null and tags3==null">
				AND (tqj.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqj.tag_id LIKE
				CONCAT('%','${tags2}','%'))
			</when>
			<when test="tags1!=null and tags2==null">
				AND tqj.tag_id LIKE CONCAT('%','${tags1}','%')
			</when>
		</choose>
		<if test="grade !=null">
			and tqj.knowledge=#{grade}
		</if>
		<if test="science !=null">
			and tqj.question_degree=#{science}
		</if>
		order by rand() limit #{number};
	</select>


	<select id="getJudgeByTeacherId" parameterType="Integer"
		resultMap="JudgeMap">
		select * from tb_question_judge qj 
		left join tb_teacher t on qj.teacher_id=t.teacher_id
		left join tb_subject s on qj.subject=s.subject_id 
		left join tb_grade g on qj.knowledge=g.grade_id
		where qj.teacher_id=#{teacherId} and qj.is_remove &lt;&gt;1
		<if test="handoutType != null and handoutType != ''">
			and qj.question_type=#{handoutType}
		</if>
		<if test="subject != null and subject != ''">
			and qj.subject=#{subject}
		</if>

		<if test="questionDegree != null and questionDegree != ''">
			and qj.question_degree=#{questionDegree}
		</if>
		<if test="tagId !=null and tagId !=''">
			and qj.tag_id REGEXP '(^|,)${tagId}($|,)'
		</if>
		<if test="isPublic != null">
			and qj.ispublic=#{isPublic}
		</if>
		order by qj.create_time desc limit #{pageNo},#{pageSize}
	</select>

	<select id="getJudgeByTeacherIdIsPublic" parameterType="Integer"
		resultMap="JudgeMap">
		select * from tb_question_judge qj 
		left join tb_subject s on qj.subject=s.subject_id
		LEFT JOIN tb_teacher t ON qj.teacher_id=t.teacher_id
		left join tb_grade g on qj.knowledge=g.grade_id
		where (qj.teacher_id=#{teacherId} or qj.ispublic=1) and qj.is_remove
		&lt;&gt;1
		<if test="handoutType != null and handoutType != ''">
			and qj.question_type=#{handoutType}
		</if>
		<if test="subject != null and subject != ''">
			and qj.subject=#{subject}
		</if>

		<if test="questionDegree != null and questionDegree != ''">
			and qj.question_degree=#{questionDegree}
		</if>
		<if test="tagId != null">
			and qj.tag_id REGEXP '(^|,)${tagId}($|,)'
		</if>
		<if test="isPublic != null">
			and qj.ispublic=#{isPublic}
		</if>
		<if test="gradeId != null">
			and qj.knowledge=#{gradeId}
		</if>
		<if test="gradeId != null">
			and qj.knowledge=#{gradeId}
		</if>
		order by qj.create_time desc limit #{pageNo},#{pageSize}
	</select>

	<update id="updateQuestionJudge" parameterType="com.db.entity.QuestionJudge">
		update tb_question_judge set
		judge_desc=#{judgeDesc},judge_answer=#{answer},
		subject=#{subject},knowledge=#{knowledge},knowledge_begin=#{knowledgeBegin},
		knowledge_end=#{knowledgeEnd},question_degree=#{degree},question_type=#{type},question_source=
		#{source},teacher_id=#{teacherId},ispublic=#{ispublic},update_time=#{updateTime}
		<if test="answerDesc!=null and answerDesc!=''">
			<![CDATA[,choice_answer_desc=#{answerDesc}]]>
		</if>
		<if test="score!=null and score!=''">
			<![CDATA[,question_score=#{score}]]>
		</if>
		<if test="tag!=null and tag!=''">
			<![CDATA[,tag_id=#{tag}]]>
		</if>
		<if test="useCount!=null and useCount!=''">
			<![CDATA[,used_count=#{useCount}]]>
		</if>
		<if test="rightCount!=null and rightCount!=''">
			<![CDATA[,right_count=#{rightCount}]]>
		</if>
		<if test="faultCount!=null and faultCount!=''">
			<![CDATA[,fault_count=#{faultCount}]]>
		</if>
		where choice_id=#{choiceId};
	</update>

	<!-- <delete id="deleteQuestionJudge" parameterType="Integer"> delete from 
		tb_question_judge where judge_id=#{judgeId}; </delete> -->
	<update id="deleteQuestionJudge" parameterType="com.db.entity.QuestionJudge">
		update tb_question_judge set is_remove=1 where judge_id=#{judgeId};
	</update>

	<select id="kesListdetails" resultMap="JudgeMap">
		select * from
		tb_my_mistakes m left join tb_question_judge qj on
		m.question_id=qj.judge_id
		where m.student_id=#{0} limit #{1},#{2}
	</select>
	<select id="thePapersById" resultMap="JudgeMap">
		select * from
		tb_paper_details mp right join tb_question_judge q on
		mp.question_id=q.judge_id LEFT JOIN tb_questions_type tqt ON
		mp.question_type=tqt.topic_id
		where mp.paper_id=#{paperId} and
		mp.question_type=3
		<if test="pageNo != null and pageSize != null">
		 limit #{pageNo},#{pageSize}
		</if>
	</select>
	<select id="theHomeworkById" resultMap="JudgeMap">
		select * from
		td_homework_details thd right join tb_question_judge q on
		thd.question_id=q.judge_id
		where thd.paper_id=#{paperId} and
		thd.question_type=#{type} 
		<if test="pageNo != null and pageSize != null">
		 limit #{pageNo},#{pageSize}
		</if>
	</select>

	<select id="findHomeworkDetails" resultMap="JudgeMap">
		select * from td_homework_details h left join tb_question_judge q on
		h.question_id=q.judge_id
		where h.paper_id=#{paperId} and
		h.question_type=3
	</select>

	<select id="findPaperInfoDetails" resultMap="JudgeMap">
		select * from tb_paper_details h left join tb_question_judge q on
		h.question_id=q.judge_id
		where h.paper_id=#{paperId} and
		h.question_type=3
	</select>
	<select id="getcount" resultType="Integer">

		select count(*) from tb_question_judge where is_remove&lt;&gt;1 and
		teacher_id=#{teacherId}
		<if test="handoutType != null and handoutType != ''">
			and question_type=#{handoutType}
		</if>
		<if test="subject != null and subject != ''">
			and subject=#{subject}
		</if>

		<if test="questionDegree != null and questionDegree != ''">
			and question_degree=#{questionDegree}
		</if>
		<if test="tagId !=null and tagId !=''">
			and tag_id REGEXP '(^|,)${tagId}($|,)'
		</if>
		<if test="isPublic != null">
			and ispublic=#{isPublic}
		</if>
		<if test="gradeId != null">
			and knowledge=#{gradeId}
		</if>
	</select>

	<select id="getconutIspublic" resultType="Integer">

		select count(*) from tb_question_judge where (teacher_id=#{teacherId}
		or ispublic=1) and is_remove&lt;&gt;1
		<if test="handoutType != null and handoutType != ''">
			and question_type=#{handoutType}
		</if>
		<if test="subject != null and subject != ''">
			and subject=#{subject}
		</if>

		<if test="questionDegree != null and questionDegree != ''">
			and question_degree=#{questionDegree}
		</if>
		<if test="tagId != null">
			and tag_id REGEXP '(^|,)${tagId}($|,)'
		</if>
		<if test="isPublic != null">
			and ispublic=#{isPublic}
		</if>
		<if test="gradeId != null">
			and knowledge=#{gradeId}
		</if>
	</select>
	<select id="errorParsinDetails" resultMap="JudgeMap">
		select * from tb_my_mistakes mp
		left join tb_question_judge qsc on mp.question_id=qsc.judge_id

		where mp.student_id=#{studentId} and mp.question_id=#{questionId}
	</select>
	<select id="thePapersAnswerById" resultMap="JudgeMap">
		SELECT * FROM td_paper_answer pa left join tb_questions_type qt on
		pa.question_type=qt.topic_id
		RIGHT JOIN tb_question_judge qs ON
		pa.question_id=qs.judge_id
		WHERE
		pa.student_id=#{0} AND pa.paper_id=#{1} AND pa.question_type=#{2}
		limit #{3},#{4}
	</select>
	<select id="theHomeworkAnswerById" resultMap="JudgeMap">
		SELECT * FROM td_homework_answer pa left join tb_questions_type qt on
		pa.question_type=qt.topic_id
		RIGHT JOIN tb_question_judge qs ON
		pa.question_id=qs.judge_id
		WHERE
		pa.student_id=#{0} AND pa.paper_id=#{1} AND pa.question_type=#{2}
		limit #{3},#{4}
	</select>
	<update id="updateIspublic" parameterType="com.db.entity.QuestionJudge">
		update
		tb_question_judge set ispublic=#{ispublic2},update_time=#{updateTime}
		where judge_id=#{judgeId};
	</update>
	<update id="updateUsecount" parameterType="com.db.entity.QuestionJudge">
		update
		tb_question_judge set used_count=#{useCount},update_time=#{updateTime}
		where judge_id=#{judgeId};
	</update>
	<update id="updateQuestion" parameterType="com.db.entity.QuestionJudge">
		update tb_question_judge
		<set>
			update_time=#{updateTime}
			<if test="judgeDesc !=null and judgeDesc !=''">
				,judge_desc=#{judgeDesc}
			</if>
			<if test="answer2 !=null and answer2 !=''">
				,judge_answer=#{answer2}
			</if>
			<if test="answerDesc2 !=null and answerDesc2 !=''">
				,judge_answer_desc=#{answerDesc2}
			</if>
			<if test="subject !=null and subject !=''">
				,subject=#{subject}
			</if>
			<if test="knowledge !=null and knowledge !=''">
				,knowledge=#{knowledge}
			</if>
			<if test="knowledgeBegin !=null and knowledgeBegin !=''">
				,knowledge_begin=#{knowledgeBegin}
			</if>
			<if test="knowledgeEnd !=null and knowledgeEnd !=''">
				,knowledge_end=#{knowledgeEnd}
			</if>
			<if test="degree2 !=null and degree2 !=''">
				,question_degree=#{degree2}
			</if>
			<if test="type !=null and type !=''">
				,question_type=#{type}
			</if>
			<if test="source2 !=null and source2 !=''">
				,question_source=#{source2}
			</if>
			<if test="score2 !=null and score2 !=''">
				,question_score=#{score2}
			</if>
			<if test="tag2 !=null and tag2 !=''">
				,tag_id=#{tag2}
			</if>
		</set>
		where judge_id=#{judgeId}
	</update>
	<select id="getTageId" resultMap="JudgeMap">
		select * from tb_question_judge where tag_id like CONCAT
		('%','${tagId}','%') and is_remove&lt;&gt;1
	</select>
	<select id="getQuestionSource" resultMap="JudgeMap">
		select * from tb_question_judge where question_source=#{sourceId} and
		is_remove &lt;&gt;1
	</select>
	<select id="getknowledgeBegin" resultMap="JudgeMap">
		select * from tb_question_judge where is_remove &lt;&gt;1 and
		knowledge_begin=#{lessonId}<!--  or knowledge_end=#{lessonId} -->
	</select>
	<select id="getAllQuestionsCount" resultType="Integer">

		select count(*) from tb_question_judge where is_remove&lt;&gt;1
		<if test="handoutType != null and handoutType != ''">
			and question_type=#{handoutType}
		</if>
		<if test="subject != null and subject != ''">
			and subject=#{subject}
		</if>

		<if test="questionDegree != null and questionDegree != ''">
			and question_degree=#{questionDegree}
		</if>
		<if test="tagId != null">
			and tag_id REGEXP '(^|,)${tagId}($|,)'
		</if>
		<if test="isPublic != null">
			and ispublic=#{isPublic}
		</if>
		<if test="gradeId != null">
			and knowledge=#{gradeId}
		</if>
	</select>
	<select id="getAllQuestions" parameterType="Integer" resultMap="JudgeMap">
		select * from tb_question_judge qjj 
		left join tb_subject s on qjj.subject=s.subject_id
		LEFT JOIN tb_teacher t ON qjj.teacher_id=t.teacher_id
		left join tb_grade g on qjj.knowledge=g.grade_id
		where is_remove&lt;&gt;1
		<if test="handoutType != null and handoutType != ''">
			and qjj.question_type=#{handoutType}
		</if>
		<if test="subject != null and subject != ''">
			and qjj.subject=#{subject}
		</if>

		<if test="questionDegree != null and questionDegree != ''">
			and qjj.question_degree=#{questionDegree}
		</if>
		<if test="tagId != null">
			and qjj.tag_id REGEXP '(^|,)${tagId}($|,)'
		</if>
		<if test="isPublic != null">
			and qjj.ispublic=#{isPublic}
		</if>
		<if test="gradeId != null">
			and qjj.knowledge=#{gradeId}
		</if>
		order by qjj.create_time desc limit #{pageNo},#{pageSize}
	</select>
	<select id="getSubjectById" resultMap="JudgeMap">
		select * from tb_question_judge where subject=#{subjectId}
	</select>
	<select id="getQuestionJudgeTitle" resultMap="JudgeMap">
	select * from tb_question_judge where judge_desc=#{judgeDesc}
	</select>
</mapper>