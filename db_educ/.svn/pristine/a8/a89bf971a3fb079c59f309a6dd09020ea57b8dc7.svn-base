<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.db.service.PaperInfoService">

	<resultMap id="PaperInfoMap" type="com.db.entity.PaperInfo">
		<result column="pi_id" property="piId" jdbcType="INTEGER" />
		<result column="pi_name" property="piName" jdbcType="VARCHAR" />
		<result column="subject" property="subject" jdbcType="INTEGER" />
		<result column="pi_type" property="piType" jdbcType="INTEGER" />
		<result column="grade" property="grade" jdbcType="INTEGER" />
		<result column="science" property="science" jdbcType="INTEGER" />
		<result column="used_times" property="usedTimes" jdbcType="INTEGER" />
		<result column="is_public" property="isPublic" jdbcType="INTEGER" />
		<result column="knowledge_begin" property="knowledgeBegin"
			jdbcType="INTEGER" />
		<result column="knowledge_end" property="knowledgeEnd"
			jdbcType="INTEGER" />
		<result column="difficulty_value" property="difficultyValue"
			jdbcType="INTEGER" />
		<result column="build_user" property="buildUser" jdbcType="INTEGER" />
		<result column="create_time" property="createTime" />
		<result column="update_time" property="updateTime" />
		<result column="build_user_name" property="buildUserName"
			jdbcType="VARCHAR" />
		<result column="topic_totai" property="topicTotai" jdbcType="VARCHAR" />
		<result column="total_score" property="totalScore" jdbcType="DOUBLE" />
		<result column="paper_explain" property="paperExplain"
			jdbcType="VARCHAR" />
		<result column="paper_time" property="paperTime" jdbcType="INTEGER" />
        <result column="is_start" property="isStart" jdbcType="INTEGER" />
		<!--连表1 -->
		<association property="subject2" javaType="com.db.entity.Subject">
			<id property="subjectId" column="subject_id" />
			<result property="subjectName" column="subject_name" />
		</association>

		<association property="grade2" javaType="com.db.entity.Grade">
			<id column="grade_id" property="gradeId" jdbcType="INTEGER" />
			<result column="grade_name" property="gradeName" jdbcType="VARCHAR" />
		</association>

		<!--连表2 -->
		<association property="questionsType" javaType="com.db.entity.QuestionsType">
			<id property="topicId" column="topic_id" />
			<result property="topicName" column="topic_name" />
			<result property="createTime" column="create_time" />
			<result property="updateTime" column="update_time" />
			<result property="typicOrder" column="typic_order" />
		</association>
		<!--连表3 -->
		<association property="paperDetails" javaType="com.db.entity.PaperDetails">
			<id property="questionId" column="question_id" />
			<result property="paperId" column="paper_id" />
			<result property="value" column="value" />
			<result property="number" column="number" />
			<result property="createTime" column="create_time" />
		</association>
		<association property="paperType" javaType="com.db.entity.TaskType">
			<id column="type_id" property="typeId" jdbcType="INTEGER" />
			<result column="tasktype_name" property="taskTypeName"
				jdbcType="VARCHAR" />
		</association>
	</resultMap>


	<!-- 只能读自己的（没有读的权限）-->
	<select id="paperInfoList" resultMap="PaperInfoMap">
		select * from tb_paper_info pi left join tb_grade g on
		pi.grade=g.grade_id left join tb_subject ts on
		pi.subject=ts.subject_id
		left join td_task_type ttt on
		pi.pi_type=ttt.type_id where (pi.build_user=#{teacherId} or pi.is_public=1) 
		<if test="pInfo.piName != null and pInfo.piName != ''">
			and pi.pi_name like CONCAT('%','${pInfo.piName}','%')
		</if>
		<if test="type!= null">
			and pi.pi_type &lt;&gt;4
		</if>
		<if test="pInfo.grade != null and pInfo.grade != ''">
			and pi.grade=#{pInfo.grade}
		</if>
		<if test="pInfo.subject != null and pInfo.subject!= ''">
			and pi.subject=#{pInfo.subject}
		</if>
		<if test="pInfo.isPublic != null">
			and pi.is_public=#{pInfo.isPublic}
		</if>
		<if test="subjectId != null and subjectId !=''">
			and pi.subject=#{subjectId}
		</if>
		<if test="gradeId != null and gradeId !=''">
			and pi.grade=#{gradeId}
		</if>
		order by pi.create_time desc limit #{pageNo},#{pageSize}
	</select>
	
	<select id="paperInfoList1" resultMap="PaperInfoMap">
		select * from tb_paper_info pi left join tb_grade g on
		pi.grade=g.grade_id left join tb_subject ts on
		pi.subject=ts.subject_id
		left join td_task_type ttt on
		pi.pi_type=ttt.type_id where (pi.build_user=#{teacherId} or pi.is_public=1) and pi.is_start = 1 
		<if test="pInfo.piName != null and pInfo.piName != ''">
			and pi.pi_name like CONCAT('%','${pInfo.piName}','%')
		</if>
		<if test="type!= null">
			and pi.pi_type &lt;&gt;4
		</if>
		<if test="isTest != null">
			and pi.pi_type=1
		</if>
		<if test="pInfo.grade != null and pInfo.grade != ''">
			and pi.grade=#{pInfo.grade}
		</if>
		<if test="pInfo.subject != null and pInfo.subject!= ''">
			and pi.subject=#{pInfo.subject}
		</if>
		<if test="pInfo.isPublic != null">
			and pi.is_public=#{pInfo.isPublic}
		</if>
		<if test="subjectId != null and subjectId !=''">
			and pi.subject=#{subjectId}
		</if>
		<if test="gradeId != null and gradeId !=''">
			and pi.grade=#{gradeId}
		</if>
		order by pi.create_time desc limit #{pageNo},#{pageSize}
	</select>
	
	<select id="findAdminList" resultMap="PaperInfoMap">
		select * from tb_paper_info pi left join tb_grade g on
		pi.grade=g.grade_id left join tb_subject ts on
		pi.subject=ts.subject_id
		left join td_task_type ttt on
		pi.pi_type=ttt.type_id where 1=1 and pi.is_start = 1 
		<if test="isTask != null">
		and pi.pi_type&lt;&gt;4
		</if>
		<if test="subject != null and subject !=''">
			and pi.subject=#{subject}
		</if>
		<if test="gradeId != null and gradeId !=''">
			and pi.grade=#{gradeId}
		</if>
		<if test="isTest != null">
			and pi.pi_type=1
		</if>
		order by pi.create_time desc limit #{pageNo},#{pageSize}
	</select>
	
	
	<!-- 能读自己的和别人所有公开的试卷 -->
	<select id="paperInfoIsPublicList" resultMap="PaperInfoMap">
		select * from tb_paper_info pi left join tb_grade g on
		pi.grade=g.grade_id
		left join tb_subject sub on pi.subject=sub.subject_id
		where
		(pi.build_user=#{teacherId} OR pi.is_public=1)

		<if test="pInfo.piName != null and pInfo.piName != ''">
			and pi.pi_name like CONCAT('%','${pInfo.piName}','%')
		</if>
		<if test="pInfo.piType != null and pInfo.piType != ''">
			and pi.pi_type=#{pInfo.piType}
		</if>
		<if test="pInfo.grade != null and pInfo.grade != ''">
			and pi.grade=#{pInfo.grade}
		</if>
		<if test="pInfo.subject != null and pInfo.subject!= ''">
			and pi.subject=#{pInfo.subject}
		</if>

		<if test="pInfo.isPublic != null">
			and pi.is_public=#{pInfo.isPublic}
		</if>
		order by pi.create_time desc limit #{pageNo},#{pageSize}
	</select>

	<!-- 查看试卷详情 -->

	<select id="getPaperInfoById" resultMap="PaperInfoMap">
		select * from
		tb_paper_info info left join tb_subject sub on info.subject=sub.subject_id
		  left join tb_grade g on info.grade=g.grade_id where info.pi_id=#{piId}
	</select>
    <select id="getPiIdById" resultMap="PaperInfoMap">
	select * from tb_paper_info where pi_id=#{piId}
</select>
	<!-- 新增试卷 -->
	<insert id="addPaperInfo" parameterType="com.db.entity.PaperInfo"
		useGeneratedKeys="true" keyProperty="piId">
		insert into tb_paper_info
		(pi_name,subject,pi_type,grade,is_public,build_user,create_time,build_user_name
		<if test="usedTimes!=null and usedTimes!=''">
      <![CDATA[,used_times]]>
		</if>

		<if test="knowledgeBegin!=null and knowledgeBegin!=''">
      <![CDATA[,knowledge_begin]]>
		</if>

		<if test="knowledgeEnd!=null and knowledgeEnd!=''">
      <![CDATA[,knowledge_end]]>
		</if>

		<if test="difficultyValue!=null and difficultyValue!=''">
      <![CDATA[,difficulty_value]]>
		</if>
		<if test="totalScore!=null and totalScore!=''">
      <![CDATA[,total_score]]>
		</if>
		<if test="topicTotai !=null and topicTotai !=''">
      <![CDATA[,topic_totai]]>
		</if>

		<if test="updateTime!=null and updateTime!=''">
      <![CDATA[,update_time]]>
		</if>
		<if test="paperExplain !=null and paperExplain !=''">
              <![CDATA[,paper_explain]]>
		</if>
		<if test="paperTime !=null">
              <![CDATA[,paper_time]]>
		</if>
		<if test="science !=null">
              <![CDATA[,science]]>
		</if>
		)
		values(#{piName},#{subject},#{piType},#{grade},#{isPublic},#{buildUser},#{createTime},#{buildUserName}
		<if test="usedTimes!=null and usedTimes!=''">
      <![CDATA[,#{usedTimes}]]>
		</if>

		<if test="knowledgeBegin!=null and knowledgeBegin!=''">
      <![CDATA[,#{knowledgeBegin}]]>
		</if>

		<if test="knowledgeEnd!=null and knowledgeEnd!=''">
      <![CDATA[,#{knowledgeEnd}]]>
		</if>

		<if test="difficultyValue!=null and difficultyValue!=''">
      <![CDATA[,#{difficultyValue}]]>
		</if>
		<if test="totalScore!=null and totalScore!=''">
      <![CDATA[,#{totalScore}]]>
		</if>
		<if test="topicTotai !=null and topicTotai !=''">
      <![CDATA[,#{topicTotai}]]>
		</if>
		<if test="updateTime!=null and updateTime!=''">
      <![CDATA[,#{updateTime}]]>
		</if>
		<if test="paperExplain !=null and paperExplain !=''">
              <![CDATA[,#{paperExplain}]]>
		</if>
		<if test="paperTime !=null">
              <![CDATA[,#{paperTime}]]>
		</if>
		<if test="science !=null">
              <![CDATA[,#{science}]]>
		</if>
		)
	</insert>

	<!-- 删除试卷 -->
	<delete id="deletePaperInfo" parameterType="Integer">
		delete from
		tb_paper_info where pi_id=#{piId}
	</delete>

	<!-- 修改试卷 -->
	<update id="updatePaper" parameterType="com.db.entity.PaperInfo">
		update tb_paper_info
		<set>
			update_time=#{updateTime}
			<if test="piName != null and piName!=''">
				,pi_name=#{piName}
			</if>
			<if test="subject != null">
				,subject=#{subject}
			</if>
			<if test="piType != null">
				,pi_type=#{piType}
			</if>
			<if test="grade != null">
				,grade=#{grade}
			</if>
			<if test="science != null and science !=''">
				,science=#{science}
			</if>
			<if test="knowledgeBegin !=null and knowledgeBegin!=''">
				,knowledge_begin=#{knowledgeBegin}
			</if>
			<if test="knowledgeEnd !=null and knowledgeEnd!=''">
				,knowledge_end=#{knowledgeEnd}
			</if>
			<if test="difficultyValue != null">
				,difficulty_value=#{difficultyValue}
			</if>
			<if test="paperExplain != null and paperExplain !=''">
				,paper_explain=#{paperExplain}
			</if>
			<if test="isPublic != null">
				,is_public=#{isPublic}
			</if>
			<if test="paperTime != null">
				,paper_time=#{paperTime}
			</if>
			<if test="isStart != null">
			   ,is_start = #{isStart}
			</if>
		</set>
		where pi_id=#{piId}
	</update>
	<select id="findPaperTotai" resultType="int">
		select count(*) from
		tb_paper_info where pi_id=#{piId}
	</select>

	<select id="getEntrancePaperList" resultMap="PaperInfoMap">
		select * from
		tb_paper_info tpr left join tb_subject ts on tpr.subject=ts.subject_id
		left join td_task_type ttt on tpr.pi_type=ttt.type_id left join
		tb_grade tg on
		tpr.grade=tg.grade_id
		where (tpr.build_user=#{teacherId}
		or tpr.is_public=1) and tpr.pi_type=4 and tpr.subject=#{subjectId} and
		tpr.grade=#{gradeId} limit #{pageNo},#{pageSize};
	</select>
	<select id="getEntrancePaperListCount" resultType="long">
		select
		COALESCE(count(*),0) from
		tb_paper_info tpr left join tb_subject ts on
		tpr.subject=ts.subject_id
		left join td_task_type ttt on
		tpr.pi_type=ttt.type_id
		where (tpr.build_user=#{teacherId} or
		tpr.is_public=1) and tpr.pi_type=4 and tpr.subject=#{subjectId} and
		tpr.grade=#{gradeId};
	</select>
	<select id="getCount" resultType="int">
		select count(*) from
		tb_paper_info where 1=1
	</select>
	
	<!-- 当前登录的老师 -->
	<select id="getPaperByItemsCount" resultType="int">
	select count(*) from
	tb_paper_info tp where (tp.build_user=#{teacherId} or tp.is_public=1)
	
	<if test="isTask != null">
	and tp.pi_type &lt;&gt;4
	</if>
	<if test="type != null">
		and tp.pi_type=#{type}
	</if>
	<if test="grade != null">
		and tp.grade=#{grade}
	</if>
	<if test="start != '' and start != null">
		and tp.knowledge_begin=#{start}
	</if>
	<if test="end != '' and end != null">
		and tp.knowledge_end=#{end}
	</if>
	<if test="subject != null">
		and tp.subject=#{subject}
	</if>
	<if test="science != '' and science != null">
		and tp.science=#{science}
	</if>
	<if test="piName != '' and piName != null">
		and tp.pi_name like CONCAT('%','${piName}','%')
	</if>
</select>
<!-- 当前登录的管理员 -->
	<select id="getPaperByCount" resultType="int">
	select count(*) from
	tb_paper_info tp where 1=1
	
	<if test="isTask != null">
		and tp.pi_type &lt;&gt;4
   </if>
	<if test="type != null">
		and tp.pi_type=#{type}
	</if>
	<if test="grade != null">
		and tp.grade=#{grade}
	</if>
	<if test="start != '' and start != null">
		and tp.knowledge_begin=#{start}
	</if>
	<if test="end != '' and end != null">
		and tp.knowledge_end=#{end}
	</if>
	<if test="subject != null">
		and tp.subject=#{subject}
	</if>
	<if test="science != '' and science != null">
		and tp.science=#{science}
	</if>
	<if test="piName != '' and piName != null">
		and tp.pi_name like CONCAT('%','${piName}','%')
	</if>
</select>
	<!-- 非管理员 -->
	<select id="getPaperByItems" resultMap="PaperInfoMap">
		select * from tb_paper_info tp left join tb_grade tg on
		tp.grade=tg.grade_id left join tb_subject sub on
		tp.subject=sub.subject_id
		<where>
	(tp.build_user=#{teacherId} or tp.is_public=1) 
	
	<if test="isTask != null">
	and tp.pi_type &lt;&gt;4
	</if>
	<if test="type != null">
	and tp.pi_type=#{type}
   </if>
	<if test="grade != null">
		and tp.grade=#{grade}
	</if>
	<if test="start != '' and start != null">
		and tp.knowledge_begin=#{start}
	</if>
	<if test="end != '' and end != null">
		and tp.knowledge_end=#{end}
	</if>
	<if test="subject != null">
		and tp.subject=#{subject}
	</if>
	<if test="science != '' and science != null">
		and tp.science=#{science}
	</if>
	<if test="piName != '' and piName != null">
		and tp.pi_name like CONCAT('%','${piName}','%')
	</if>
	order by tp.create_time desc limit #{pageNo},#{pageSize}
		</where>
	</select>
	<!-- 管理员 -->
	<select id="getPaperBy" resultMap="PaperInfoMap">
	select * from tb_paper_info tp left join tb_grade tg on
	tp.grade=tg.grade_id left join tb_subject sub on
	tp.subject=sub.subject_id
	<where>
		1=1
		<if test="isTask != null">
		and	tp.pi_type &lt;&gt;4
     </if>
	<if test="type != null">
		and tp.pi_type=#{type}
	</if>
	<if test="grade != null">
		and tp.grade=#{grade}
	</if>
	<if test="start != '' and start != null">
		and tp.knowledge_begin=#{start}
	</if>
	<if test="end != '' and end != null">
		and tp.knowledge_end=#{end}
	</if>
	<if test="subject != null">
		and tp.subject=#{subject}
	</if>
	<if test="science != '' and science != null">
		and tp.science=#{science}
	</if>
	<if test="piName != '' and piName != null">
		and tp.pi_name like CONCAT('%','${piName}','%')
	</if>
	order by tp.create_time desc limit #{pageNo},#{pageSize}
		</where>
	</select>
	
	<select id="getPaperByContent" resultMap="PaperInfoMap">
		select * from
		tb_paper_info tp left join tb_grade tg on tp.grade=tg.grade_id
		where
		tp.pi_name like '%${content}%' and tp.is_public=1;
	</select>
	<!-- 给课程添加考卷所选的试卷 -->
	<select id="getPublicExam" resultMap="PaperInfoMap">
		select * from tb_paper_info
		tpi left
		join tb_grade tg on
		tpi.grade=tg.grade_id left join tb_subject
		ts on tpi.subject=ts.subject_id
		left join td_task_type ttt on
		tpi.pi_type=ttt.type_id where is_public=1
		order by tpi.create_time desc limit #{pageNo},#{pageSize}
	</select>
	<select id="getPublicExamCount" resultType="long">
		select count(*) from tb_paper_info pi left join tb_grade g on
		pi.grade=g.grade_id left join tb_subject ts on
		pi.subject=ts.subject_id
		left join td_task_type ttt on
		pi.pi_type=ttt.type_id
		where (pi.build_user=#{teacherId} or pi.is_public=1) and pi.is_start=1 and pi.pi_type&lt;&gt;4
		<if test="pInfo.piName != null and pInfo.piName != ''">
			and pi.pi_name like CONCAT('%','${pInfo.piName}','%')
		</if>
		<if test="pInfo.piType != null and pInfo.piType != ''">
			and pi.pi_type=#{pInfo.piType}
		</if>
		<if test="pInfo.grade != null and pInfo.grade != ''">
			and pi.grade=#{pInfo.grade}
		</if>
		<if test="pInfo.subject != null and pInfo.subject!= ''">
			and pi.subject=#{pInfo.subject}
		</if>
		<if test="pInfo.isPublic != null">
			and pi.is_public=#{pInfo.isPublic}
		</if>
		<if test="subjectId != null and subjectId !=''">
			and pi.subject=#{subjectId}
		</if>
		<if test="isTest != null">
			and pi.pi_type=1
		</if>
		<if test="gradeId != null and gradeId !=''">
			and pi.grade=#{gradeId}
		</if>
	</select>
	
	
	<select id="findAdminCount" resultType="int">
		select count(*) from tb_paper_info pi left join tb_grade g on
		pi.grade=g.grade_id left join tb_subject ts on
		pi.subject=ts.subject_id
		left join td_task_type ttt on
		pi.pi_type=ttt.type_id
		where 1=1 and pi.is_start = 1
		<if test="isTask != null">
		and pi.pi_type&lt;&gt;4
		</if>
		<if test="subject != null and subject !=''">
			and pi.subject=#{subject}
		</if>
		<if test="gradeId != null and gradeId !=''">
			and pi.grade=#{gradeId}
		</if>
		<if test="isTest != null">
			and pi.pi_type=1
		</if>
	</select>
	<update id="updateUsertimes" parameterType="com.db.entity.PaperInfo">
		update tb_paper_info
		set used_times=#{usedTimes},update_time=#{updateTime}
		where pi_id=#{piId};
	</update>
	
	<!--所有公开试卷总数  -->
	<select id="isPublicCount" resultType="int">
		select count(*) from tb_paper_info where 1=1 
		<choose>
	<when test="type == 5 or type == 6">
		and build_user=#{teacherId} and is_public=1
	</when>
	<otherwise>
		and is_public=1
	</otherwise>
		</choose>
		
	</select>
	<!-- 只能能读取自己的试卷 -->
	<select id="getPaperCount" resultType="int">
		select count(*) from tb_paper_info where build_user=#{teacherId}
		<if test="pInfo.piName != null and pInfo.piName != ''">
			and pi_name like CONCAT('%','${pInfo.piName}','%')
		</if>
		<if test="pInfo.piType != null and pInfo.piType != ''">
			and pi_type=#{pInfo.piType}
		</if>
		<if test="pInfo.grade != null and pInfo.grade != ''">
			and grade=#{pInfo.grade}
		</if>
		<if test="pInfo.subject != null and pInfo.subject != ''">
			and subject=#{pInfo.subject}
		</if>
		<if test="pInfo.isPublic != null">
			and is_public=#{pInfo.isPublic}
		</if>
	</select>
	<!-- 能读取所有公开的试卷 -->
	<select id="getPaperCount1" resultType="int">
		select count(*) from tb_paper_info where build_user=#{teacherId} OR
		is_public=1
		<if test="pInfo.piName != null and pInfo.piName != ''">
			and pi_name like CONCAT('%','${pInfo.piName}','%')
		</if>
		<if test="pInfo.piType != null">
			and pi_type=#{pInfo.piType}
		</if>
		<if test="pInfo.grade != null">
			and grade=#{pInfo.grade}
		</if>
		<if test="pInfo.subject != null">
			and subject=#{pInfo.subject}
		</if>
		<if test="pInfo.isPublic != null">
			and is_public=#{pInfo.isPublic}
		</if>
	</select>

	<select id="getPaperInfoPiId" resultMap="PaperInfoMap">
		select * from tb_paper_info where pi_id=#{piId}
	</select>
	<select id="updateUsedTimes" parameterType="com.db.entity.PaperInfo">
		update tb_paper_info set update_time=#{updateTime},used_times=#{usedTimes}
		where pi_id=#{piId}
	</select>
	
	<update id="updateTopictotal" parameterType="com.db.entity.PaperInfo">
	update tb_paper_info
	<set>
		update_time=#{updateTime}
		<if test="topicTotai != null">
			,topic_totai=#{topicTotai}
		</if>
		<if test="totalScore != null">
			,total_score=#{totalScore}
		</if>
	</set>
	where pi_id=#{piId}
</update>

	<select id="getScience" resultMap="PaperInfoMap">
		select * from tb_paper_info where science=#{materialId}
	</select>
	<select id="getPaperType" resultMap="PaperInfoMap">
		select * from tb_paper_info where pi_type=#{typeId}
	</select>
	<select id="getknowledgeBegin" resultMap="PaperInfoMap">
		select * from tb_paper_info where knowledge_begin=#{lessonId} or
		knowledge_end=#{lessonId}
	</select>
	<select id="seePaperCount" resultType="int">
		select count(*) from tb_paper_info where 1=1
		<if test="pInfo.piName != null and pInfo.piName != ''">
			and pi_name like CONCAT('%','${pInfo.piName}','%')
		</if>
		<if test="pInfo.piType != null">
			and pi_type=#{pInfo.piType}
		</if>
		<if test="pInfo.grade != null ">
			and grade=#{pInfo.grade}
		</if>
		<if test="pInfo.subject != null">
			and subject=#{pInfo.subject}
		</if>
		<if test="pInfo.isPublic != null">
			and is_public=#{pInfo.isPublic}
		</if>
	</select>
	<select id="seepaperInfoIsPublicList" resultMap="PaperInfoMap">
		select * from tb_paper_info pi left join tb_grade g on
		pi.grade=g.grade_id
		left join tb_subject sub on pi.subject=sub.subject_id
		where 1=1
		<if test="pInfo.piName != null and pInfo.piName != ''">
			and pi.pi_name like CONCAT('%','${pInfo.piName}','%')
		</if>
		<if test="pInfo.piType != null">
			and pi.pi_type=#{pInfo.piType}
		</if>
		<if test="pInfo.grade != null">
			and pi.grade=#{pInfo.grade}
		</if>
		<if test="pInfo.subject != null">
			and pi.subject=#{pInfo.subject}
		</if>
		<if test="pInfo.isPublic != null">
			and pi.is_public=#{pInfo.isPublic}
		</if>
		order by pi.create_time desc limit #{pageNo},#{pageSize}
	</select>
	
	<select id="getPaperBy1" resultMap="PaperInfoMap">
	select * from tb_paper_info tp left join tb_grade tg on
	tp.grade=tg.grade_id left join tb_subject sub on
	tp.subject=sub.subject_id
	<where>
		1=1 and tp.is_start = 1
		<if test="isTask != null">
		and	tp.pi_type &lt;&gt;4
     </if>
	<if test="type != null">
		and tp.pi_type=#{type}
	</if>
	<if test="grade != null">
		and tp.grade=#{grade}
	</if>
	<if test="start != '' and start != null">
		and tp.knowledge_begin=#{start}
	</if>
	<if test="end != '' and end != null">
		and tp.knowledge_end=#{end}
	</if>
	<if test="subject != null">
		and tp.subject=#{subject}
	</if>
	<if test="science != '' and science != null">
		and tp.science=#{science}
	</if>
	<if test="piName != '' and piName != null">
		and tp.pi_name like CONCAT('%','${piName}','%')
	</if>
	order by tp.create_time desc limit #{pageNo},#{pageSize}
		</where>
	</select>





<select id="getPaperByCount1" resultType="int">
	select count(*) from
	tb_paper_info tp where  tp.is_start = 1
	
	<if test="isTask != null">
		and tp.pi_type &lt;&gt;4
   </if>
	<if test="type != null">
		and tp.pi_type=#{type}
	</if>
	<if test="grade != null">
		and tp.grade=#{grade}
	</if>
	<if test="start != '' and start != null">
		and tp.knowledge_begin=#{start}
	</if>
	<if test="end != '' and end != null">
		and tp.knowledge_end=#{end}
	</if>
	<if test="subject != null">
		and tp.subject=#{subject}
	</if>
	<if test="science != '' and science != null">
		and tp.science=#{science}
	</if>
	<if test="piName != '' and piName != null">
		and tp.pi_name like CONCAT('%','${piName}','%')
	</if>
</select>

<select id="getPaperByItems1" resultMap="PaperInfoMap">
		select * from tb_paper_info tp left join tb_grade tg on
		tp.grade=tg.grade_id left join tb_subject sub on
		tp.subject=sub.subject_id
		<where>
	(tp.build_user=#{teacherId} or tp.is_public=1) and tp.is_start = 1 
	
	<if test="isTask != null">
	and tp.pi_type &lt;&gt;4
	</if>
	<if test="type != null">
	and tp.pi_type=#{type}
   </if>
	<if test="grade != null">
		and tp.grade=#{grade}
	</if>
	<if test="start != '' and start != null">
		and tp.knowledge_begin=#{start}
	</if>
	<if test="end != '' and end != null">
		and tp.knowledge_end=#{end}
	</if>
	<if test="subject != null">
		and tp.subject=#{subject}
	</if>
	<if test="science != '' and science != null">
		and tp.science=#{science}
	</if>
	<if test="piName != '' and piName != null">
		and tp.pi_name like CONCAT('%','${piName}','%')
	</if>
	order by tp.create_time desc limit #{pageNo},#{pageSize}
		</where>
	</select>

<select id="getPaperByItemsCount1" resultType="int">
	select count(*) from
	tb_paper_info tp where (tp.build_user=#{teacherId} or tp.is_public=1) and tp.is_start=1
	
	<if test="isTask != null">
	and tp.pi_type &lt;&gt;4
	</if>
	<if test="type != null">
		and tp.pi_type=#{type}
	</if>
	<if test="grade != null">
		and tp.grade=#{grade}
	</if>
	<if test="start != '' and start != null">
		and tp.knowledge_begin=#{start}
	</if>
	<if test="end != '' and end != null">
		and tp.knowledge_end=#{end}
	</if>
	<if test="subject != null">
		and tp.subject=#{subject}
	</if>
	<if test="science != '' and science != null">
		and tp.science=#{science}
	</if>
	<if test="piName != '' and piName != null">
		and tp.pi_name like CONCAT('%','${piName}','%')
	</if>
</select>
</mapper>