<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.db.service.QuestionMulitChoiceService">
	<resultMap id="MulitMap" type="com.db.entity.QuestionMulitChoice">
		<result column="choice_id" property="choiceId" jdbcType="INTEGER" />
		<result column="choice_desc" property="choiceDesc1" jdbcType="VARCHAR" />
		<result column="choice_optionA" property="OptionA1" jdbcType="VARCHAR" />
		<result column="choice_optionB" property="OptionB1" jdbcType="VARCHAR" />
		<result column="choice_optionC" property="OptionC1" jdbcType="VARCHAR" />
		<result column="choice_optionD" property="OptionD1" jdbcType="VARCHAR" />
		<result column="choice_answer" property="answer1" jdbcType="VARCHAR" />
		<result column="choice_answer_desc" property="answerDesc1"
			jdbcType="VARCHAR" />
		<result column="subject" property="subject" jdbcType="INTEGER" />
		<result column="knowledge" property="knowledge" jdbcType="INTEGER" />
		<result column="knowledge_begin" property="knowledgeBegin"
			jdbcType="VARCHAR" />
		<result column="knowledge_end" property="knowledgeEnd"
			jdbcType="VARCHAR" />
		<result column="question_degree" property="degree1" jdbcType="INTEGER" />
		<result column="question_type" property="type" jdbcType="INTEGER" />
		<result column="question_source" property="source1" jdbcType="INTEGER" />
		<result column="question_score" property="score1" jdbcType="FLOAT" />
		<result column="tag_id" property="tag1" jdbcType="VARCHAR" />
		<result column="teacher_id" property="teacherId" jdbcType="INTEGER" />
		<result column="used_count" property="useCount" jdbcType="INTEGER" />
		<result column="right_count" property="rightCount" jdbcType="INTEGER" />
		<result column="fault_count" property="faultCount" jdbcType="INTEGER" />
		<result column="ispublic" property="ispublic1" jdbcType="INTEGER" />
		<result column="create_time" property="createTime" />
		<result column="update_time" property="updateTime" />
		<result column="is_remove" property="isRemove" jdbcType="INTEGER" />

		<association property="homeworkDetails" javaType="com.db.entity.HomeworkDetails">
			<id property="hdId" column="hd_id" />
			<result column="question_id" property="questionId" jdbcType="INTEGER" />
			<result column="question_type" property="questionType"
				jdbcType="INTEGER" />
			<result column="paper_id" property="paperId" jdbcType="INTEGER" />
			<result column="value" property="value" jdbcType="INTEGER" />
			<result column="create_time" property="createTime" />
			<result column="update_time" property="updateTime" />
		</association>


		<association property="paperDetails" javaType="com.db.entity.PaperDetails">
			<id property="id" column="id" />
			<result column="question_id" property="questionId" jdbcType="INTEGER" />
			<result column="question_type" property="questionType"
				jdbcType="INTEGER" />
			<result column="paper_id" property="paperId" jdbcType="INTEGER" />
			<result column="value" property="value" jdbcType="INTEGER" />
			<result column="create_time" property="createTime" />
			<result column="update_time" property="updateTime" />
		</association>

		<association property="myMistakes" javaType="com.db.entity.MyMistakes">
			<id column="mistakes_id" property="mistakesId" jdbcType="INTEGER" />
			<result column="student_id" property="studentId" jdbcType="INTEGER" />
			<result column="mistakes_number" property="mistakesNumber"
				jdbcType="INTEGER" />
			<result column="topic_type" property="topicType" jdbcType="INTEGER" />
			<result column="current_mistakes" property="currentMistakes"
				jdbcType="INTEGER" />
			<result column="question_id" property="questionId" jdbcType="INTEGER" />
			<result column="value" property="value" jdbcType="INTEGER" />
			<result column="paper_id" property="paperId" jdbcType="INTEGER" />
			<result column="create_time" property="createTime" />
		</association>


		<association property="questionsType" javaType="com.db.entity.QuestionsType">
			<id column="topic_id" property="topicId" jdbcType="INTEGER" />
			<result column="topic_name" property="topicName" jdbcType="VARCHAR" />
			<result column="create_time" property="createTime" />
			<result column="update_time" property="updateTime" />
			<result column="typic_order" property="typicOrder" jdbcType="INTEGER" />
		</association>
		<association property="paperAnswer" javaType="com.db.entity.PaperAnswer">
			<id column="answer_id" property="answerId" jdbcType="INTEGER" />
			<result column="paper_id" property="paperId" jdbcType="INTEGER" />
			<result column="write_answer" property="writeAnswer" jdbcType="VARCHAR" />
			<result column="is_true" property="isTrue" jdbcType="INTEGER" />
			<result column="question_type" property="questionType"
				jdbcType="INTEGER" />
		</association>
		<association javaType="com.db.entity.HomeworkAnswer"
			property="homeworkanswer">
			<id column="answer_id" property="answerId" jdbcType="INTEGER" />
			<result column="student_id" property="studentId" jdbcType="INTEGER" />
			<result column="question_id" property="questionId" jdbcType="INTEGER" />
			<result column="question_type" property="questionType"
				jdbcType="INTEGER" />
			<result column="write_answer" property="writeAnswer" jdbcType="VARCHAR" />
			<result column="value" property="value" jdbcType="INTEGER" />
			<result column="paper_id" property="paperId" jdbcType="INTEGER" />
			<result column="is_true" property="isTrue" jdbcType="INTEGER" />
		</association>

		<association property="subject2" javaType="com.db.entity.Subject">
			<id column="subject_id" property="subjectId" jdbcType="INTEGER" />
			<result column="subject_name" property="subjectName" jdbcType="VARCHAR" />
		</association>
		
		<association property="grade" javaType="com.db.entity.Grade">
			<id column="grade_id" property="gradeId" jdbcType="INTEGER" />
			<result column="grade_name" property="gradeName" jdbcType="VARCHAR" />
		</association>
		<association property="teacher" javaType="com.db.entity.Teacher">
			<id column="teacher_id" property="teacherId" jdbcType="INTEGER" />
			<result column="teacher_name" property="teacherName" jdbcType="VARCHAR" />
		</association>
	</resultMap>

	<select id="getQuestionMulitHom" resultMap="MulitMap">
		select * from td_homework_details thd right join
		tb_question_mulitchoice tqm on
		thd.question_id=tqm.choice_id
		where
		thd.paper_id=#{0} and thd.question_type=#{1} limit #{2},#{3}
		<!-- select * from td_homework_details h left join tb_question_mulitchoice 
			q on -->
		<!-- h.question_id=q.choice_id -->
		<!-- where h.student_id=#{0} limit #{1},#{2} -->
	</select>

	<select id="questionMulitPaper" resultMap="MulitMap">
		select * from
		tb_paper_details p left join tb_question_mulitchoice q on
		p.question_id=q.choice_id
		where p.paper_id=#{0} limit #{1},#{2}
	</select>

	<insert id="addQuestionMulit" parameterType="com.db.entity.QuestionMulitChoice"
		useGeneratedKeys="true" keyProperty="choiceId">
		insert into
		tb_question_mulitchoice(choice_desc,choice_optionA,choice_optionB,
		choice_optionC,choice_optionD,choice_answer,subject,knowledge,
		question_degree,question_type,question_source,teacher_id,ispublic,create_time
		<if test="answerDesc1!=null and answerDesc1!=''">
			<![CDATA[,choice_answer_desc]]>
		</if>
		<if test="score1!=null and score1!=''">
			<![CDATA[,question_score]]>
		</if>
		<if test="tag1!=null and tag1!=''">
			<![CDATA[,tag_id]]>
		</if>
		<if test="useCount!=null and useCount!=''">
			<![CDATA[,used_count]]>
		</if>
		<if test="rightCount!=null and rightCount!=''">
			<![CDATA[,right_count]]>
		</if>
		<if test="faultCount!=null and faultCount!=''">
			<![CDATA[,fault_count]]>
		</if>
		<if test="knowledgeBegin !=null and knowledgeBegin !=''">
			<![CDATA[,knowledge_begin]]>
		</if>
		<if test="knowledgeEnd !=null and knowledgeEnd !=''">
			<![CDATA[,knowledge_end]]>
		</if>
		) values
		(#{choiceDesc1},#{OptionA1},#{OptionB1},#{OptionC1},#{OptionD1},#{answer1},#{subject},#{knowledge},
		#{degree1},#{type},#{source1},#{teacherId},#{ispublic1},#{createTime}
		<if test="answerDesc1!=null and answerDesc1!=''">
			<![CDATA[,#{answerDesc1}]]>
		</if>
		<if test="score1!=null and score1!=''">
			<![CDATA[,#{score1}]]>
		</if>
		<if test="tag1!=null and tag1!=''">
			<![CDATA[,#{tag1}]]>
		</if>
		<if test="useCount!=null and useCount!=''">
			<![CDATA[,#{useCount}]]>
		</if>
		<if test="rightCount!=null and rightCount!=''">
			<![CDATA[,#{rightCount}]]>
		</if>
		<if test="faultCount!=null and faultCount!=''">
			<![CDATA[,#{faultCount}]]>
		</if>
		<if test="knowledgeBegin !=null and knowledgeBegin !=''">
			<![CDATA[,#{knowledgeBegin}]]>
		</if>
		<if test="knowledgeEnd !=null and knowledgeEnd !=''">
			<![CDATA[,#{knowledgeEnd}]]>
		</if>
		)
	</insert>

	<select id="getMulitChoiceById" parameterType="Integer"
		resultMap="MulitMap">
		select * from tb_question_mulitchoice where
		choice_id=#{choiceId};
	</select>
	<!--只能拿自己和别人公开的题目 -->
	<select id="getMulitByRand" resultMap="MulitMap">
		select * from tb_question_mulitchoice tqm left join tb_questions_type
		tqt on tqm.question_type=tqt.topic_id
		<where>
			(tqm.teacher_id=#{teacherId} or tqm.ispublic=1)
			<if test="type!=null and type!=''">
				and tqm.question_type=#{type}
			</if>
			<if test="subject!=null and subject!=''">
				and tqm.subject=#{subject}
			</if>
			<if test="score!=null and score!=''">
				and tqm.question_score=#{score}
			</if>
			<if test="listTag !=null and listTag !=''">
				and tqm.tag_id in
				<foreach collection="listTag" item="listTag" open="("
					separator="," close=")">
					#{listTag}
				</foreach>
			</if>
			<if test="grade !=null">
				and tqm.knowledge=#{grade}
			</if>
			<if test="science !=null">
				and tqm.question_degree=#{science}
			</if>
		</where>
		order by rand() limit #{number};
	</select>

	<!--管理员拿全部题目 -->
	<select id="getMulitByRandAdmin" resultMap="MulitMap">
		select * from tb_question_mulitchoice tqm left join tb_questions_type
		tqt on tqm.question_type=tqt.topic_id
		where tqm.is_remove &lt;&gt;1
		<if test="type!=null and type!=''">
			and tqm.question_type=#{type}
		</if>
		<if test="subject!=null and subject!=''">
			and tqm.subject=#{subject}
		</if>
		<!-- <if test="score!=null and score!=''"> -->
		<!-- and tqm.question_score=#{score} -->
		<!-- </if> -->
		<choose>
			<when test="tags10!=null">
				AND (tqm.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqm.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqm.tag_id LIKE
				CONCAT('%','${tags3}','%') OR tqm.tag_id LIKE
				CONCAT('%','${tags4}','%')
				OR tqm.tag_id LIKE
				CONCAT('%','${tags5}','%') OR tqm.tag_id LIKE
				CONCAT('%','${tags6}','%')
				OR tqm.tag_id LIKE
				CONCAT('%','${tags7}','%') OR tqm.tag_id LIKE
				CONCAT('%','${tags8}','%')
				OR tqm.tag_id LIKE
				CONCAT('%','${tags9}','%') OR tqm.tag_id LIKE
				CONCAT('%','${tags10}','%'))
			</when>
			<when test="tags9!=null and tags10==null">
				AND (tqm.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqm.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqm.tag_id LIKE
				CONCAT('%','${tags3}','%') OR tqm.tag_id LIKE
				CONCAT('%','${tags4}','%')
				OR tqm.tag_id LIKE
				CONCAT('%','${tags5}','%') OR tqm.tag_id LIKE
				CONCAT('%','${tags6}','%')
				OR tqm.tag_id LIKE
				CONCAT('%','${tags7}','%') OR tqm.tag_id LIKE
				CONCAT('%','${tags8}','%')
				OR tqm.tag_id LIKE
				CONCAT('%','${tags9}','%'))
			</when>
			<when test="tags8!=null and tags9==null">
				AND (tqm.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqm.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqm.tag_id LIKE
				CONCAT('%','${tags3}','%') OR tqm.tag_id LIKE
				CONCAT('%','${tags4}','%')
				OR tqm.tag_id LIKE
				CONCAT('%','${tags5}','%') OR tqm.tag_id LIKE
				CONCAT('%','${tags6}','%')
				OR tqm.tag_id LIKE
				CONCAT('%','${tags7}','%') OR tqm.tag_id LIKE
				CONCAT('%','${tags8}','%'))
			</when>
			<when test="tags7!=null and tags8==null">
				AND (tqm.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqm.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqm.tag_id LIKE
				CONCAT('%','${tags3}','%') OR tqm.tag_id LIKE
				CONCAT('%','${tags4}','%')
				OR tqm.tag_id LIKE
				CONCAT('%','${tags5}','%') OR tqm.tag_id LIKE
				CONCAT('%','${tags6}','%')
				OR tqm.tag_id LIKE
				CONCAT('%','${tags7}','%'))
			</when>
			<when test="tags6!=null and tags7==null">
				AND (tqm.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqm.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqm.tag_id LIKE
				CONCAT('%','${tags3}','%') OR tqm.tag_id LIKE
				CONCAT('%','${tags4}','%')
				OR tqm.tag_id LIKE
				CONCAT('%','${tags5}','%') OR tqm.tag_id LIKE
				CONCAT('%','${tags6}','%'))
			</when>
			<when test="tags5!=null and tags6==null">
				AND (tqm.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqm.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqm.tag_id LIKE
				CONCAT('%','${tags3}','%') OR tqm.tag_id LIKE
				CONCAT('%','${tags4}','%')
				OR tqm.tag_id LIKE
				CONCAT('%','${tags5}','%'))
			</when>
			<when test="tags4!=null and tags5==null">
				AND (tqm.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqm.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqm.tag_id LIKE
				CONCAT('%','${tags3}','%') OR tqm.tag_id LIKE
				CONCAT('%','${tags4}','%'))
			</when>
			<when test="tags3!=null and tags4==null">
				AND (tqm.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqm.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqm.tag_id LIKE
				CONCAT('%','${tags3}','%'))
			</when>
			<when test="tags2!=null and tags3==null">
				AND (tqm.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqm.tag_id LIKE
				CONCAT('%','${tags2}','%'))
			</when>
			<when test="tags1!=null and tags2==null">
				AND tqm.tag_id LIKE CONCAT('%','${tags1}','%')
			</when>
		</choose>
		<if test="grade !=null">
			and tqm.knowledge=#{grade}
		</if>
		<if test="science !=null">
			and tqm.question_degree=#{science}
		</if>
		order by rand() limit #{number};
	</select>
	<select id="getMulitByRandAdminIsPublic" resultMap="MulitMap">
		select * from tb_question_mulitchoice tqm left join tb_questions_type
		tqt on tqm.question_type=tqt.topic_id
		<where>
			(tqm.teacher_id=#{teacherId} or tqm.ispublic=1) and tqm.is_remove
			&lt;&gt;1
			<if test="type!=null and type!=''">
				and tqm.question_type=#{type}
			</if>
			<if test="subject!=null and subject!=''">
				and tqm.subject=#{subject}
			</if>
			<choose>
			<when test="tags10!=null">
				AND (tqm.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqm.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqm.tag_id LIKE
				CONCAT('%','${tags3}','%') OR tqm.tag_id LIKE
				CONCAT('%','${tags4}','%')
				OR tqm.tag_id LIKE
				CONCAT('%','${tags5}','%') OR tqm.tag_id LIKE
				CONCAT('%','${tags6}','%')
				OR tqm.tag_id LIKE
				CONCAT('%','${tags7}','%') OR tqm.tag_id LIKE
				CONCAT('%','${tags8}','%')
				OR tqm.tag_id LIKE
				CONCAT('%','${tags9}','%') OR tqm.tag_id LIKE
				CONCAT('%','${tags10}','%'))
			</when>
			<when test="tags9!=null and tags10==null">
				AND (tqm.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqm.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqm.tag_id LIKE
				CONCAT('%','${tags3}','%') OR tqm.tag_id LIKE
				CONCAT('%','${tags4}','%')
				OR tqm.tag_id LIKE
				CONCAT('%','${tags5}','%') OR tqm.tag_id LIKE
				CONCAT('%','${tags6}','%')
				OR tqm.tag_id LIKE
				CONCAT('%','${tags7}','%') OR tqm.tag_id LIKE
				CONCAT('%','${tags8}','%')
				OR tqm.tag_id LIKE
				CONCAT('%','${tags9}','%'))
			</when>
			<when test="tags8!=null and tags9==null">
				AND (tqm.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqm.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqm.tag_id LIKE
				CONCAT('%','${tags3}','%') OR tqm.tag_id LIKE
				CONCAT('%','${tags4}','%')
				OR tqm.tag_id LIKE
				CONCAT('%','${tags5}','%') OR tqm.tag_id LIKE
				CONCAT('%','${tags6}','%')
				OR tqm.tag_id LIKE
				CONCAT('%','${tags7}','%') OR tqm.tag_id LIKE
				CONCAT('%','${tags8}','%'))
			</when>
			<when test="tags7!=null and tags8==null">
				AND (tqm.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqm.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqm.tag_id LIKE
				CONCAT('%','${tags3}','%') OR tqm.tag_id LIKE
				CONCAT('%','${tags4}','%')
				OR tqm.tag_id LIKE
				CONCAT('%','${tags5}','%') OR tqm.tag_id LIKE
				CONCAT('%','${tags6}','%')
				OR tqm.tag_id LIKE
				CONCAT('%','${tags7}','%'))
			</when>
			<when test="tags6!=null and tags7==null">
				AND (tqm.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqm.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqm.tag_id LIKE
				CONCAT('%','${tags3}','%') OR tqm.tag_id LIKE
				CONCAT('%','${tags4}','%')
				OR tqm.tag_id LIKE
				CONCAT('%','${tags5}','%') OR tqm.tag_id LIKE
				CONCAT('%','${tags6}','%'))
			</when>
			<when test="tags5!=null and tags6==null">
				AND (tqm.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqm.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqm.tag_id LIKE
				CONCAT('%','${tags3}','%') OR tqm.tag_id LIKE
				CONCAT('%','${tags4}','%')
				OR tqm.tag_id LIKE
				CONCAT('%','${tags5}','%'))
			</when>
			<when test="tags4!=null and tags5==null">
				AND (tqm.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqm.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqm.tag_id LIKE
				CONCAT('%','${tags3}','%') OR tqm.tag_id LIKE
				CONCAT('%','${tags4}','%'))
			</when>
			<when test="tags3!=null and tags4==null">
				AND (tqm.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqm.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqm.tag_id LIKE
				CONCAT('%','${tags3}','%'))
			</when>
			<when test="tags2!=null and tags3==null">
				AND (tqm.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqm.tag_id LIKE
				CONCAT('%','${tags2}','%'))
			</when>
			<when test="tags1!=null and tags2==null">
				AND tqm.tag_id LIKE CONCAT('%','${tags1}','%')
			</when>
		</choose>
			<if test="grade !=null">
				and tqm.knowledge=#{grade}
			</if>
			<if test="science !=null">
				and tqm.question_degree=#{science}
			</if>
		</where>
		order by rand() limit #{number};
	</select>

	<select id="getMulitByTeacherId" parameterType="Integer"
		resultMap="MulitMap">
		select * from tb_question_mulitchoice qm 
		left join tb_teacher t on qm.teacher_id=t.teacher_id
		left join tb_subject s on qm.subject=s.subject_id
		left join tb_grade g on qm.knowledge=g.grade_id
		where qm.teacher_id=#{teacherId} and qm.is_remove&lt;&gt;1
		<if test="handoutType != null and handoutType != ''">
			and qm.question_type=#{handoutType}
		</if>
		<if test="subject != null and subject != ''">
			and qm.subject=#{subject}
		</if>

		<if test="questionDegree != null and questionDegree != ''">
			and qm.question_degree=#{questionDegree}
		</if>
		<if test="tagId !=null and tagId !=''">
			and qm.tag_id REGEXP '(^|,)${tagId}($|,)'
		</if>
		<if test="isPublic != null">
			and qm.ispublic=#{isPublic}
		</if>
		<if test="gradeId != null">
			and qm.knowledge=#{gradeId}
		</if>
		order by qm.create_time desc limit #{pageNo},#{pageSize}
	</select>

	<select id="getMulitByTeacherIdIsPublic" parameterType="Integer"
		resultMap="MulitMap">
		select * from tb_question_mulitchoice qm 
		left join tb_subject s on qm.subject=s.subject_id
		LEFT JOIN tb_teacher t ON qm.teacher_id=t.teacher_id
		left join tb_grade g on qm.knowledge=g.grade_id
		where (qm.teacher_id=#{teacherId} or qm.ispublic=1) and
		qm.is_remove&lt;&gt;1
		<if test="handoutType != null and handoutType != ''">
			and qm.question_type=#{handoutType}
		</if>
		<if test="subject != null and subject != ''">
			and qm.subject=#{subject}
		</if>

		<if test="questionDegree != null and questionDegree != ''">
			and qm.question_degree=#{questionDegree}
		</if>
		<if test="tagId != null">
			and qm.tag_id REGEXP '(^|,)${tagId}($|,)'
		</if>
		<if test="isPublic != null">
			and qm.ispublic=#{isPublic}
		</if>
		<if test="gradeId != null">
			and qm.knowledge=#{gradeId}
		</if>
		order by qm.create_time desc limit #{pageNo},#{pageSize}
	</select>

	<update id="updateQuestionMulit" parameterType="com.db.entity.QuestionMulitChoice">
		update tb_question_mulitchoice set
		choice_desc=#{choiceDesc1},choice_optionA=#{OptionA1},
		choice_optionB=#{OptionB1},choice_optionC=#{OptionC1},choice_optionD=#{OptionD1},choice_answer=
		#{answer1},subject=#{subject},knowledge=#{knowledge},knowledge_begin=#{knowledgeBegin},
		knowledge_end=#{knowledgeEnd},question_degree=#{degree1},question_type=#{type},question_source=
		#{source1},teacher_id=#{teacherId},ispublic=#{ispublic1},update_time=#{updateTime}
		<if test="answerDesc!=null and answerDesc!=''">
			<![CDATA[,choice_answer_desc=#{answerDesc1}]]>
		</if>
		<if test="score!=null and score!=''">
			<![CDATA[,question_score=#{score1}]]>
		</if>
		<if test="tag!=null and tag!=''">
			<![CDATA[,tag_id=#{tag1}]]>
		</if>
		<if test="useCount!=null and useCount!=''">
			<![CDATA[,used_count=#{useCount}]]>
		</if>
		<if test="rightCount!=null and rightCount!=''">
			<![CDATA[,right_count=#{rightCount}]]>
		</if>
		<if test="faultCount!=null and faultCount!=''">
			<![CDATA[,fault_count=#{faultCount}]]>
		</if>
		where choice_id=#{choiceId};
	</update>

	<!-- <delete id="deleteQuestionMulit" parameterType="Integer"> delete from 
		tb_question_mulitchoice where choice_id=#{choiceId}; </delete> -->

	<update id="deleteQuestionMulit" parameterType="com.db.entity.QuestionMulitChoice">
		update tb_question_mulitchoice set is_remove=1 where choice_id=#{choiceId};
	</update>
	<select id="kesListdetails" resultMap="MulitMap">
		select * from
		tb_my_mistakes m left join tb_question_mulitchoice qm on
		m.question_id=qm.choice_id
		where m.student_id=#{0} limit #{1},#{2}
	</select>

	<select id="thePapersById" resultMap="MulitMap">
		select * from
		tb_paper_details mp right join tb_question_mulitchoice q on
		mp.question_id=q.choice_id LEFT JOIN tb_questions_type qqq ON
		mp.question_type=qqq.topic_id
		where mp.paper_id=#{paperId} and
		mp.question_type=2 
		<if test="pageNo != null and pageSize != null">
		limit #{pageNo},#{pageSize}
		</if>
	</select>
	<select id="theHomeworkById" resultMap="MulitMap">
		select * from
		td_homework_details thd right join tb_question_mulitchoice q on
		thd.question_id=q.choice_id
		where thd.paper_id=#{paperId} and
		thd.question_type=#{type} 
		<if test="pageNo != null and pageSize != null">
		limit #{pageNo},#{pageSize}
		</if>
	</select>

	<select id="findHomeworkDetails" resultMap="MulitMap">
		select * from td_homework_details h left join tb_question_mulitchoice q on
		h.question_id=q.choice_id
		where h.paper_id=#{paperId} and
		h.question_type=2
	</select>


	<select id="findPaperInfoDetails" resultMap="MulitMap">
		select * from tb_paper_details h left join tb_question_mulitchoice q on
		h.question_id=q.choice_id
		where h.paper_id=#{paperId} and
		h.question_type=2
	</select>
	<select id="getcount" resultType="Integer">
		select count(*) from tb_question_mulitchoice where is_remove &lt;&gt;1
		and teacher_id=#{teacherId}
		<if test="handoutType != null and handoutType != ''">
			and question_type=#{handoutType}
		</if>
		<if test="subject != null and subject != ''">
			and subject=#{subject}
		</if>

		<if test="questionDegree != null and questionDegree != ''">
			and question_degree=#{questionDegree}
		</if>
		<if test="tagId !=null and tagId !=''">
			and tag_id REGEXP '(^|,)${tagId}($|,)'
		</if>
		<if test="isPublic != null">
			and ispublic=#{isPublic}
		</if>
		<if test="gradeId != null">
			and knowledge=#{gradeId}
		</if>
	</select>

	<select id="getconutIspublic" resultType="Integer">
		select count(*) from tb_question_mulitchoice where
		(teacher_id=#{teacherId} or ispublic=1) and is_remove &lt;&gt;1
		<if test="handoutType != null and handoutType != ''">
			and question_type=#{handoutType}
		</if>
		<if test="subject != null and subject != ''">
			and subject=#{subject}
		</if>

		<if test="questionDegree != null and questionDegree != ''">
			and question_degree=#{questionDegree}
		</if>
		<if test="tagId != null">
			and tag_id REGEXP '(^|,)${tagId}($|,)'
		</if>
		<if test="isPublic != null">
			and ispublic=#{isPublic}
		</if>
		<if test="gradeId != null">
			and knowledge=#{gradeId}
		</if>
	</select>

	<select id="errorParsinDetails" resultMap="MulitMap">
		select * from tb_my_mistakes mp
		left join tb_question_mulitchoice qsc on mp.question_id=qsc.choice_id

		where mp.student_id=#{studentId} and mp.question_id=#{questionId}
	</select>
	<select id="thePapersAnswerById" resultMap="MulitMap">
		SELECT * FROM td_paper_answer pa left join tb_questions_type qt on
		pa.question_type=qt.topic_id
		RIGHT JOIN tb_question_mulitchoice qs ON
		pa.question_id=qs.choice_id
		WHERE
		pa.student_id=#{0} AND pa.paper_id=#{1} AND pa.question_type=#{2}
		limit #{3},#{4}
	</select>
	<select id="theHomeworkAnswerById" resultMap="MulitMap">
		SELECT * FROM
		td_homework_answer pa left join tb_questions_type qt on
		pa.question_type=qt.topic_id
		RIGHT JOIN tb_question_mulitchoice qs ON
		pa.question_id=qs.choice_id
		WHERE
		pa.student_id=#{0} AND pa.paper_id=#{1} AND pa.question_type=#{2}
		limit #{3},#{4}
	</select>
	<update id="updateIspublic" parameterType="com.db.entity.QuestionMulitChoice">
		update
		tb_question_mulitchoice set
		ispublic=#{ispublic1},update_time=#{updateTime} where
		choice_id=#{choiceId};
	</update>
	<update id="updateUsecount" parameterType="com.db.entity.QuestionMulitChoice">
		update
		tb_question_mulitchoice set
		used_count=#{useCount},update_time=#{updateTime} where
		choice_id=#{choiceId};
	</update>
	<update id="updateQuestion" parameterType="com.db.entity.QuestionMulitChoice">
		update tb_question_mulitchoice
		<set>
			update_time=#{updateTime}
			<if test="choiceDesc1 !=null and choiceDesc1 !=''">
				,choice_desc=#{choiceDesc1}
			</if>
			<if test="OptionA1 !=null and OptionA1 !=''">
				,choice_optionA=#{OptionA1}
			</if>
			<if test="OptionB1 !=null and OptionB1 !=''">
				,choice_optionB=#{OptionB1}
			</if>
			<if test="OptionC1 !=null and OptionC1 !=''">
				,choice_optionC=#{OptionC1}
			</if>
			<if test="OptionD1 !=null and OptionD1 !=''">
				,choice_optionD=#{OptionD1}
			</if>
			<if test="answer1 !=null and answer1 !=''">
				,choice_answer=#{answer1}
			</if>
			<if test="answerDesc1 !=null and answerDesc1 !=''">
				,choice_answer_desc=#{answerDesc1}
			</if>
			<if test="subject !=null and subject !=''">
				,subject=#{subject}
			</if>
			<if test="knowledge !=null and knowledge !=''">
				,knowledge=#{knowledge}
			</if>
			<if test="knowledgeBegin !=null and knowledgeBegin !=''">
				,knowledge_begin=#{knowledgeBegin}
			</if>
			<if test="knowledgeEnd !=null and knowledgeEnd !=''">
				,knowledge_end=#{knowledgeEnd}
			</if>
			<if test="degree1 !=null and degree1 !=''">
				,question_degree=#{degree1}
			</if>
			<if test="type !=null and type !=''">
				,question_type=#{type}
			</if>
			<if test="source1 !=null and source1 !=''">
				,question_source=#{source1}
			</if>
			<if test="score1 !=null and score1 !=''">
				,question_score=#{score1}
			</if>
			<if test="tag1 !=null and tag1 !=''">
				,tag_id=#{tag1}
			</if>
		</set>
		where choice_id=#{choiceId}
	</update>
	<select id="getTageId" resultMap="MulitMap">
		select * from tb_question_mulitchoice where tag_id like CONCAT
		('%','${tagId}','%') and is_remove &lt;&gt;1
	</select>
	<select id="getQuestionSource" resultMap="MulitMap">
		select * from tb_question_mulitchoice where question_source=#{sourceId} and
		is_remove &lt;&gt;1
	</select>
	<select id="getknowledgeBegin" resultMap="MulitMap">
		select * from tb_question_mulitchoice where is_remove &lt;&gt;1
		  and knowledge_begin=#{lessonId}
	</select>
	<select id="getAllQuestionsCount" resultType="Integer">
		select count(*) from tb_question_mulitchoice where is_remove &lt;&gt;1
		<if test="handoutType != null">
			and question_type=#{handoutType}
		</if>
		<if test="subject != null">
			and subject=#{subject}
		</if>

		<if test="questionDegree != null">
			and question_degree=#{questionDegree}
		</if>
		<if test="tagId != null">
			and tag_id REGEXP '(^|,)${tagId}($|,)'
		</if>
		<if test="isPublic != null">
			and ispublic=#{isPublic}
		</if>
		<if test="gradeId != null">
			and knowledge=#{gradeId}
		</if>
	</select>
	<select id="getAllQuestions" resultMap="MulitMap">
		select * from tb_question_mulitchoice qm 
		left join tb_subject s on qm.subject=s.subject_id
		LEFT JOIN tb_teacher t ON qm.teacher_id=t.teacher_id
		left join tb_grade g on qm.knowledge=g.grade_id
		where is_remove &lt;&gt;1
		<if test="handoutType != null ">
			and qm.question_type=#{handoutType}
		</if>
		<if test="subject != null">
			and qm.subject=#{subject}
		</if>

		<if test="questionDegree != null">
			and qm.question_degree=#{questionDegree}
		</if>
		<if test="tagId != null">
			and tag_id REGEXP '(^|,)${tagId}($|,)'
		</if>
		<if test="isPublic != null">
			and qm.ispublic=#{isPublic}
		</if>
		<if test="gradeId != null">
			and qm.knowledge=#{gradeId}
		</if>
		order by qm.create_time desc limit #{pageNo},#{pageSize}
	</select>
	<select id="getSubjectById" resultMap="MulitMap">
		select * from tb_question_mulitchoice where subject=#{subjectId}
	</select>
	<select id="QuestionMulitChoiceTitle" resultMap="MulitMap">
	select * from tb_question_mulitchoice where choice_desc=#{choiceDesc1}
	</select>
</mapper>