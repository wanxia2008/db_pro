<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.db.service.SubjectiveQuestionService">
	<resultMap id="SubjectiveMap" type="com.db.entity.SubjectiveQuestion">

		<result column="subjective_id" property="subjectiveId"
			jdbcType="INTEGER" />
		<result column="subjective_title" property="subjectiveTitle"
			jdbcType="VARCHAR" />
		<result column="answer_analysis" property="answerAnalysis"
			jdbcType="VARCHAR" />
		<result column="subjective_type" property="subjectiveType"
			jdbcType="INTEGER" />
		<result column="knowledge_begin" property="knowledgeBegin"
			jdbcType="INTEGER" />
		<result column="knowledge" property="knowledge" jdbcType="INTEGER" />
		<result column="tag_id" property="tagId" jdbcType="VARCHAR" />
		<result column="question_degree" property="questionDegree"
			jdbcType="INTEGER" />
		<result column="teacher_id" property="teacherId" jdbcType="INTEGER" />
		<result column="used_count" property="usedCount" jdbcType="INTEGER" />
		<result column="question_type" property="type" jdbcType="INTEGER" />
		<result column="is_public" property="isPublic" jdbcType="INTEGER" />
		<result column="is_remove" property="isRemove" jdbcType="INTEGER" />
		<result column="subject" property="subject" jdbcType="INTEGER" />
		<result column="question_source" property="questionSource"
			jdbcType="INTEGER" />
		<result column="question_score" property="questionScore"
			jdbcType="FLOAT" />
		<result column="create_time" property="createTime" />
		<result column="update_time" property="updateTime" />


		<association property="homeworkDetails" javaType="com.db.entity.HomeworkDetails">
			<result column="hd_id" property="hdId" jdbcType="INTEGER" />
			<result column="question_id" property="questionId" jdbcType="INTEGER" />
			<result column="question_type" property="questionType"
				jdbcType="INTEGER" />
			<result column="paper_id" property="paperId" jdbcType="INTEGER" />
			<result column="value" property="value" jdbcType="INTEGER" />
			<result column="create_time" property="createTime" />
			<result column="update_time" property="updateTime" />
			<result column="subject_id" property="subjectId" />
		</association>

		<association property="paperDetails" javaType="com.db.entity.PaperDetails">
			<id column="id" property="id" jdbcType="INTEGER" />
			<result column="question_id" property="questionId" jdbcType="INTEGER" />
			<result column="question_type" property="questionType"
				jdbcType="INTEGER" />
			<result column="paper_id" property="paperId" jdbcType="INTEGER" />
			<result column="value" property="value" jdbcType="INTEGER" />
			<result column="create_time" property="createTime" />
			<result column="update_time" property="updateTime" />
		</association>

		<association property="questionsType" javaType="com.db.entity.QuestionsType">
			<id column="topic_id" property="topicId" jdbcType="INTEGER" />
			<result column="topic_name" property="topicName" jdbcType="VARCHAR" />
			<result column="create_time" property="createTime" />
			<result column="update_time" property="updateTime" />
			<result column="typic_order" property="typicOrder" jdbcType="INTEGER" />
		</association>


		<association property="myMistakes" javaType="com.db.entity.MyMistakes">
			<id column="mistakes_id" property="mistakesId" jdbcType="INTEGER" />
			<result column="student_id" property="studentId" jdbcType="INTEGER" />
			<result column="mistakes_number" property="mistakesNumber"
				jdbcType="INTEGER" />
			<result column="topic_type" property="topicType" jdbcType="INTEGER" />
			<result column="current_mistakes" property="currentMistakes"
				jdbcType="INTEGER" />
			<result column="question_id" property="questionId" jdbcType="INTEGER" />
			<result column="value" property="value" jdbcType="INTEGER" />
			<result column="paper_id" property="paperId" jdbcType="INTEGER" />
			<result column="class_id" property="classId" jdbcType="INTEGER" />
			<result column="create_time" property="createTime" />
		</association>
		<association property="paperAnswer" javaType="com.db.entity.PaperAnswer">
			<id column="answer_id" property="answerId" jdbcType="INTEGER" />
			<result column="paper_id" property="paperId" jdbcType="INTEGER" />
			<result column="write_answer" property="writeAnswer" jdbcType="VARCHAR" />
			<result column="is_true" property="isTrue" jdbcType="INTEGER" />
			<result column="question_type" property="questionType"
				jdbcType="INTEGER" />
		</association>
		<association javaType="com.db.entity.HomeworkAnswer"
			property="homeworkanswer">
			<id column="answer_id" property="answerId" jdbcType="INTEGER" />
			<result column="student_id" property="studentId" jdbcType="INTEGER" />
			<result column="question_id" property="questionId" jdbcType="INTEGER" />
			<result column="question_type" property="questionType"
				jdbcType="INTEGER" />
			<result column="write_answer" property="writeAnswer" jdbcType="VARCHAR" />
			<result column="value" property="value" jdbcType="INTEGER" />
			<result column="paper_id" property="paperId" jdbcType="INTEGER" />
		</association>

		<association property="subject2" javaType="com.db.entity.Subject">
			<id column="subject_id" property="subjectId" jdbcType="INTEGER" />
			<result column="subject_name" property="subjectName" jdbcType="VARCHAR" />
		</association>
		
		<association property="grade" javaType="com.db.entity.Grade">
			<id column="grade_id" property="gradeId" jdbcType="INTEGER" />
			<result column="grade_name" property="gradeName" jdbcType="VARCHAR" />
		</association>
		
		<association property="teacher" javaType="com.db.entity.Teacher">
			<id column="teacher_id" property="teacherId" jdbcType="INTEGER" />
			<result column="teacher_name" property="teacherName" jdbcType="VARCHAR" />
		</association>

	</resultMap>


	<select id="getSubjectiveQuestionById" resultMap="SubjectiveMap">
		select * from tb_subjective_question where subjective_id=#{subjectiveId}
	</select>

	<!-- 添加主观题 -->
	<insert id="addSubjectiveQuestion" parameterType="com.db.entity.SubjectiveQuestion">
		insert into
		tb_subjective_question
		(create_time,subjective_title,question_type,knowledge_begin,knowledge,tag_id,question_degree,teacher_id,
		used_count,is_public,is_remove,subject
		<if test="answerAnalysis != null and answerAnalysis != ''">
               <![CDATA[,answer_analysis]]>
		</if>
		<if test="subjectiveType != null">
               <![CDATA[,subjective_type]]>
		</if>
		<if test="questionSource != null">
               <![CDATA[,question_source]]>
		</if>
		)
		values(#{createTime},#{subjectiveTitle},#{type},#{knowledgeBegin},#{knowledge},#{tagId},#{questionDegree},#{teacherId}
		,#{usedCount},#{isPublic},#{isRemove},#{subject}
		<if test="answerAnalysis != null and answerAnalysis != ''">
               <![CDATA[,#{answerAnalysis}]]>
		</if>
		<if test="subjectiveType != null">
               <![CDATA[,#{subjectiveType}]]>
		</if>
		<if test="questionSource != null">
               <![CDATA[,#{questionSource}]]>
		</if>
		)
	</insert>
	<select id="getAllQuestionsCount" resultType="int">
		select count(*) from tb_subjective_question where is_remove &lt;&gt;1
		<if test="handoutType != null">
			and question_type=#{handoutType}
		</if>
		<!-- <if test="subject != null"> -->
		<!-- and subject=#{subject} -->
		<!-- </if> -->
		<if test="questionDegree != null">
			and question_degree=#{questionDegree}
		</if>
		<if test="isPublic != null">
			and is_public=#{isPublic}
		</if>
		<if test="gradeId != null">
			and knowledge=#{gradeId}
		</if>
	</select>

	<select id="getIsPublicCount" resultType="int">
		select count(*) from tb_subjective_question where
		(teacher_id=#{teacherId} or is_public=1) and is_remove &lt;&gt;1
		<if test="handoutType != null">
			and question_type=#{handoutType}
		</if>
	  <if test="subject != null">
			and subject=#{subject}
		</if>

		<if test="questionDegree != null">
			and question_degree=#{questionDegree}
		</if>
		<if test="tagId != null">
			and tag_id REGEXP '(^|,)${tagId}($|,)'
		</if>
		<if test="isPublic != null">
			and is_public=#{isPublic}
		</if>
		<if test="gradeId != null">
			and knowledge=#{gradeId}
		</if>
	</select>
	<select id="getPrivateCount" resultType="int">
		select count(*) from tb_subjective_question where
		(teacher_id=#{teacherId}) and is_remove &lt;&gt;1
		<if test="handoutType != null">
			and question_type=#{handoutType}
		</if>
		<if test="subject != null">
			and subject=#{subject}
		</if>

		<if test="questionDegree != null">
			and question_degree=#{questionDegree}
		</if>
		<if test="tagId !=null and tagId !=''">
			and tag_id REGEXP '(^|,)${tagId}($|,)'
		</if>
		<if test="isPublic != null">
			and is_public=#{isPublic}
		</if>
		<if test="gradeId != null">
			and knowledge=#{gradeId}
		</if>
	</select>
	<select id="getSubjectiveQuestion" resultMap="SubjectiveMap">
		select * from tb_subjective_question qr 
		left join tb_subject s on qr.subject=s.subject_id
		LEFT JOIN tb_teacher t ON qr.teacher_id=t.teacher_id
		left join tb_grade g on qr.knowledge=g.grade_id
		where qr.is_remove &lt;&gt;1
		<if test="handoutType != null and handoutType != ''">
			and qr.question_type=#{handoutType}
		</if>
		<if test="subject != null">
			and qr.subject=#{subject}
		</if>

		<if test="questionDegree != null and questionDegree != ''">
			and qr.question_degree=#{questionDegree}
		</if>

		<if test="isPublic != null">
			and qr.is_public=#{isPublic}
		</if>
		<if test="gradeId != null">
			and qr.knowledge=#{gradeId}
		</if>
		order by qr.create_time desc limit #{pageNo},#{pageSize}
	</select>
	<select id="getIsPublicSubjectiveQuestion" resultMap="SubjectiveMap">
		select * from tb_subjective_question qr left join tb_subject s on
		qr.subject=s.subject_id
		LEFT JOIN tb_teacher t ON qr.teacher_id=t.teacher_id
		where
		(teacher_id=#{teacherId} or is_public=1) and qr.is_remove &lt;&gt;1
		<if test="handoutType != null and handoutType != ''">
			and qr.question_type=#{handoutType}
		</if>
		<if test="subject != null">
			and qr.subject=#{subject}
		</if>

		<if test="questionDegree != null and questionDegree != ''">
			and qr.question_degree=#{questionDegree}
		</if>

		<if test="isPublic != null">
			and qr.is_public=#{isPublic}
		</if>
		order by qr.create_time desc limit #{pageNo},#{pageSize}
	</select>

	<select id="getPublicSubjectiveQuestion" resultMap="SubjectiveMap">
		select * from tb_subjective_question qr
		 left join tb_subject s on qr.subject=s.subject_id
		 LEFT JOIN tb_teacher t ON qr.teacher_id=t.teacher_id
		 left join tb_grade g on qr.knowledge=g.grade_id
		where
		(qr.teacher_id=#{teacherId} or qr.is_public=1) and qr.is_remove &lt;&gt;1
		<if test="handoutType != null and handoutType != ''">
			and qr.question_type=#{handoutType}
		</if>
		<if test="subject != null">
			and qr.subject=#{subject}
		</if>

		<if test="questionDegree != null and questionDegree != ''">
			and qr.question_degree=#{questionDegree}
		</if>
		<if test="tagId != null">
			and qr.tag_id REGEXP '(^|,)${tagId}($|,)'
		</if>
		<if test="isPublic != null">
			and qr.is_public=#{isPublic}
		</if>
		<if test="gradeId != null">
			and qr.knowledge=#{gradeId}
		</if>
		order by qr.create_time desc limit #{pageNo},#{pageSize}
	</select>

	<select id="getPrivateSubjectiveQuestion" resultMap="SubjectiveMap">
		select * from tb_subjective_question qr 
		left join tb_subject s on qr.subject=s.subject_id
		LEFT JOIN tb_teacher t ON qr.teacher_id=t.teacher_id
		left join tb_grade g on qr.knowledge=g.grade_id
		where qr.teacher_id=#{teacherId} and qr.is_remove &lt;&gt;1
		<if test="handoutType != null and handoutType != ''">
			and qr.question_type=#{handoutType}
		</if>
		
		<if test="subject != null">
			and qr.subject=#{subject}
		</if>

		<if test="questionDegree != null and questionDegree != ''">
			and qr.question_degree=#{questionDegree}
		</if>
		<if test="tagId !=null and tagId !=''">
			and qr.tag_id REGEXP '(^|,)${tagId}($|,)'
		</if>
		<if test="isPublic != null">
			and qr.is_public=#{isPublic}
		</if>
		<if test="gradeId != null">
			and qr.knowledge=#{gradeId}
		</if>
		order by qr.create_time desc limit #{pageNo},#{pageSize}
	</select>

	<!--管理员拿全部题目 -->
	<select id="getMulitByRandAdmin" resultMap="SubjectiveMap">
		select * from tb_subjective_question tqs left join tb_questions_type
		tqt on tqs.question_type=tqt.topic_id
		where tqs.is_remove &lt;&gt;1
		<if test="type !=null">
			and tqs.question_type=#{type}
		</if>
		<if test="subject!=null">
			and tqs.subject=#{subject}
		</if>
		<choose>
			<when test="tags10!=null">
				AND (tqs.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqs.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqs.tag_id LIKE
				CONCAT('%','${tags3}','%') OR tqs.tag_id LIKE
				CONCAT('%','${tags4}','%')
				OR tqs.tag_id LIKE
				CONCAT('%','${tags5}','%') ORtqs.tag_id LIKE
				CONCAT('%','${tags6}','%')
				OR tqs.tag_id LIKE
				CONCAT('%','${tags7}','%') OR tqs.tag_id LIKE
				CONCAT('%','${tags8}','%')
				OR tqs.tag_id LIKE
				CONCAT('%','${tags9}','%') OR tqs.tag_id LIKE
				CONCAT('%','${tags10}','%'))
			</when>
			<when test="tags9!=null and tags10==null">
				AND (tqs.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqs.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqs.tag_id LIKE
				CONCAT('%','${tags3}','%') OR tqs.tag_id LIKE
				CONCAT('%','${tags4}','%')
				OR tqs.tag_id LIKE
				CONCAT('%','${tags5}','%') OR tqs.tag_id LIKE
				CONCAT('%','${tags6}','%')
				OR tqs.tag_id LIKE
				CONCAT('%','${tags7}','%') OR tqs.tag_id LIKE
				CONCAT('%','${tags8}','%')
				OR tqs.tag_id LIKE
				CONCAT('%','${tags9}','%'))
			</when>
			<when test="tags8!=null and tags9==null">
				AND (tqs.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqs.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqs.tag_id LIKE
				CONCAT('%','${tags3}','%') OR tqs.tag_id LIKE
				CONCAT('%','${tags4}','%')
				OR tqs.tag_id LIKE
				CONCAT('%','${tags5}','%') OR tqs.tag_id LIKE
				CONCAT('%','${tags6}','%')
				OR tqs.tag_id LIKE
				CONCAT('%','${tags7}','%') OR tqs.tag_id LIKE
				CONCAT('%','${tags8}','%'))
			</when>
			<when test="tags7!=null and tags8==null">
				AND (tqs.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqs.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqs.tag_id LIKE
				CONCAT('%','${tags3}','%') OR tqs.tag_id LIKE
				CONCAT('%','${tags4}','%')
				OR tqs.tag_id LIKE
				CONCAT('%','${tags5}','%') OR tqs.tag_id LIKE
				CONCAT('%','${tags6}','%')
				OR tqs.tag_id LIKE
				CONCAT('%','${tags7}','%'))
			</when>
			<when test="tags6!=null and tags7==null">
				AND (tqs.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqs.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqs.tag_id LIKE
				CONCAT('%','${tags3}','%') OR tqs.tag_id LIKE
				CONCAT('%','${tags4}','%')
				OR tqs.tag_id LIKE
				CONCAT('%','${tags5}','%') OR tqs.tag_id LIKE
				CONCAT('%','${tags6}','%'))
			</when>
			<when test="tags5!=null and tags6==null">
				AND (tqs.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqs.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqs.tag_id LIKE
				CONCAT('%','${tags3}','%') OR tqs.tag_id LIKE
				CONCAT('%','${tags4}','%')
				OR tqs.tag_id LIKE
				CONCAT('%','${tags5}','%'))
			</when>
			<when test="tags4!=null and tags5==null">
				AND (tqs.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqs.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqs.tag_id LIKE
				CONCAT('%','${tags3}','%') OR tqs.tag_id LIKE
				CONCAT('%','${tags4}','%'))
			</when>
			<when test="tags3!=null and tags4==null">
				AND (tqs.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqs.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqs.tag_id LIKE
				CONCAT('%','${tags3}','%'))
			</when>
			<when test="tags2!=null and tags3==null">
				AND (tqs.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqs.tag_id LIKE
				CONCAT('%','${tags2}','%'))
			</when>
			<when test="tags1!=null and tags2==null">
				AND tqs.tag_id LIKE CONCAT('%','${tags1}','%')
			</when>
		</choose>
		<if test="grade !=null">
			and tqs.knowledge=#{grade}
		</if>
		<if test="science !=null">
			and tqs.question_degree=#{science}
		</if>
		order by rand() limit #{number};
	</select>

	<select id="getReadByRandAdminIsPublic" resultMap="SubjectiveMap">
		select * from tb_subjective_question tqs left join tb_questions_type
		tqt on tqs.question_type=tqt.topic_id
		where
		(tqs.teacher_id=#{teacherId} or tqs.is_public=1) and tqs.is_remove
		&lt;&gt;1
		<if test="type !=null">
			and tqs.question_type=#{type}
		</if>
		<if test="subject!=null">
			and tqs.subject=#{subject}
		</if>
		<choose>
			<when test="tags10!=null">
				AND (tqs.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqs.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqs.tag_id LIKE
				CONCAT('%','${tags3}','%') OR tqs.tag_id LIKE
				CONCAT('%','${tags4}','%')
				OR tqs.tag_id LIKE
				CONCAT('%','${tags5}','%') ORtqs.tag_id LIKE
				CONCAT('%','${tags6}','%')
				OR tqs.tag_id LIKE
				CONCAT('%','${tags7}','%') OR tqs.tag_id LIKE
				CONCAT('%','${tags8}','%')
				OR tqs.tag_id LIKE
				CONCAT('%','${tags9}','%') OR tqs.tag_id LIKE
				CONCAT('%','${tags10}','%'))
			</when>
			<when test="tags9!=null and tags10==null">
				AND (tqs.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqs.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqs.tag_id LIKE
				CONCAT('%','${tags3}','%') OR tqs.tag_id LIKE
				CONCAT('%','${tags4}','%')
				OR tqs.tag_id LIKE
				CONCAT('%','${tags5}','%') OR tqs.tag_id LIKE
				CONCAT('%','${tags6}','%')
				OR tqs.tag_id LIKE
				CONCAT('%','${tags7}','%') OR tqs.tag_id LIKE
				CONCAT('%','${tags8}','%')
				OR tqs.tag_id LIKE
				CONCAT('%','${tags9}','%'))
			</when>
			<when test="tags8!=null and tags9==null">
				AND (tqs.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqs.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqs.tag_id LIKE
				CONCAT('%','${tags3}','%') OR tqs.tag_id LIKE
				CONCAT('%','${tags4}','%')
				OR tqs.tag_id LIKE
				CONCAT('%','${tags5}','%') OR tqs.tag_id LIKE
				CONCAT('%','${tags6}','%')
				OR tqs.tag_id LIKE
				CONCAT('%','${tags7}','%') OR tqs.tag_id LIKE
				CONCAT('%','${tags8}','%'))
			</when>
			<when test="tags7!=null and tags8==null">
				AND (tqs.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqs.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqs.tag_id LIKE
				CONCAT('%','${tags3}','%') OR tqs.tag_id LIKE
				CONCAT('%','${tags4}','%')
				OR tqs.tag_id LIKE
				CONCAT('%','${tags5}','%') OR tqs.tag_id LIKE
				CONCAT('%','${tags6}','%')
				OR tqs.tag_id LIKE
				CONCAT('%','${tags7}','%'))
			</when>
			<when test="tags6!=null and tags7==null">
				AND (tqs.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqs.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqs.tag_id LIKE
				CONCAT('%','${tags3}','%') OR tqs.tag_id LIKE
				CONCAT('%','${tags4}','%')
				OR tqs.tag_id LIKE
				CONCAT('%','${tags5}','%') OR tqs.tag_id LIKE
				CONCAT('%','${tags6}','%'))
			</when>
			<when test="tags5!=null and tags6==null">
				AND (tqs.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqs.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqs.tag_id LIKE
				CONCAT('%','${tags3}','%') OR tqs.tag_id LIKE
				CONCAT('%','${tags4}','%')
				OR tqs.tag_id LIKE
				CONCAT('%','${tags5}','%'))
			</when>
			<when test="tags4!=null and tags5==null">
				AND (tqs.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqs.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqs.tag_id LIKE
				CONCAT('%','${tags3}','%') OR tqs.tag_id LIKE
				CONCAT('%','${tags4}','%'))
			</when>
			<when test="tags3!=null and tags4==null">
				AND (tqs.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqs.tag_id LIKE
				CONCAT('%','${tags2}','%')
				OR tqs.tag_id LIKE
				CONCAT('%','${tags3}','%'))
			</when>
			<when test="tags2!=null and tags3==null">
				AND (tqs.tag_id LIKE CONCAT('%','${tags1}','%') OR
				tqs.tag_id LIKE
				CONCAT('%','${tags2}','%'))
			</when>
			<when test="tags1!=null and tags2==null">
				AND tqs.tag_id LIKE CONCAT('%','${tags1}','%')
			</when>
		</choose>

		<if test="grade !=null">
			and tqs.knowledge=#{grade}
		</if>
		<if test="science !=null">
			and tqs.question_degree=#{science}
		</if>
		order by rand() limit #{number};
	</select>
	<update id="updatesetUsedCount" parameterType="com.db.entity.SubjectiveQuestion">
		update tb_subjective_question set
		update_time=#{updateTime},used_count=#{usedCount} where
		subjective_id=#{subjectiveId}
	</update>

	<update id="updateSubjectiveQuestion" parameterType="com.db.entity.SubjectiveQuestion">
		update tb_subjective_question
		<set>
			update_time=#{updateTime}
			<if test="subjectiveTitle != null and subjectiveTitle != ''">
				,subjective_title=#{subjectiveTitle}
			</if>
			<if test="answerAnalysis != null and answerAnalysis != ''">
				,answer_analysis=#{answerAnalysis}
			</if>
			<if test="subject != null">
				,subject=#{subject}
			</if>
			<if test="knowledgeBegin != null">
				,knowledge_begin=#{knowledgeBegin}
			</if>
			<if test="knowledge != null">
				,knowledge=#{knowledge}
			</if>
			<if test="tagId != null">
				,tag_id=#{tagId}
			</if>
			<if test="questionDegree != null">
				,question_degree=#{questionDegree}
			</if>
		</set>
		where subjective_id=#{subjectiveId}
	</update>

	<select id="findPaperInfoDetails" resultMap="SubjectiveMap">
		select * from
		tb_paper_details h left join tb_subjective_question q on
		h.question_id=q.subjective_id
		where h.paper_id=#{paperId} and
		h.question_type=5
	</select>
	<select id="findHomeworkDetails" resultMap="SubjectiveMap">
		select * from
		td_homework_details h left join tb_subjective_question q on
		h.question_id=q.subjective_id
		where h.paper_id=#{paperId} and
		h.question_type=5

	</select>

	<update id="falseDeleteSubjective" parameterType="com.db.entity.SubjectiveQuestion">
		update tb_subjective_question set is_remove=1 where
		subjective_id=#{subjectiveId}
	</update>
	<select id="thePapersById" resultMap="SubjectiveMap">
		select * from
		tb_paper_details mp right join tb_subjective_question qs on
		mp.question_id=qs.subjective_id LEFT JOIN tb_questions_type qt ON
		mp.question_type=qt.topic_id
		where mp.paper_id=#{paperId} and
		mp.question_type=#{type}
		<if test="pageNo != null and pageSize != null">
		limit #{pageNo},#{pageSize}
	</if>
	</select>
	<select id="theHomeworkById" resultMap="SubjectiveMap">
		select * from
		td_homework_details mp right join tb_subjective_question qs on
		mp.question_id=qs.subjective_id LEFT JOIN tb_questions_type qt ON
		mp.question_type=qt.topic_id
		where mp.paper_id=#{paperId} and
		mp.question_type=#{type}
		<if test="pageNo != null and pageSize != null">
		limit #{pageNo},#{pageSize}
	 </if>
	</select>

	<select id="theHomeworkAnswerById" resultMap="SubjectiveMap">
		SELECT * FROM
		td_homework_details pa LEFT JOIN tb_questions_type qt ON
		pa.question_type=qt.topic_id
		RIGHT JOIN tb_subjective_question qs ON
		pa.question_id=qs.subjective_id
		RIGHT JOIN td_homework_record hr ON
		pa.paper_id=hr.homework_id
		WHERE hr.student_id=#{studentId} AND
		pa.paper_id=#{paperId} AND pa.question_type=#{type}
		<!-- limit #{pageNo},#{pageSize} -->
	</select>
	<select id="thePaperDetailsById" resultMap="SubjectiveMap">
		SELECT * FROM
		tb_paper_details pa LEFT JOIN tb_questions_type qt ON
		pa.question_type=qt.topic_id
		RIGHT JOIN tb_subjective_question qs ON
		pa.question_id=qs.subjective_id
		RIGHT JOIN td_test_record hr ON
		pa.paper_id=hr.paper_id
		WHERE hr.student_id=#{studentId} AND
		pa.paper_id=#{paperId} AND pa.question_type=#{type}
		limit
		#{pageNo},#{pageSize}
	</select>
	<update id="updateIsPublic" parameterType="com.db.entity.SubjectiveQuestion">
		update tb_subjective_question set
		is_public=#{isPublic},update_time=#{updateTime} where
		subjective_id=#{subjectiveId}

	</update>
	<select id="getReadTageId" resultMap="SubjectiveMap">
		select * from tb_subjective_question where tag_id like CONCAT
		('%','${tagId}','%') and is_remove&lt;&gt;1
	</select>
	<select id="getSubjectiveQuestionTitle" resultMap="SubjectiveMap">
	  select * from tb_subjective_question where subjective_title=#{subjectiveTitle}
	
	</select>
</mapper>